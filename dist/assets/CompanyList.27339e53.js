import{C as f,P as C}from"./Pagination.b8ff8fbc.js";import{s as _}from"./globalFunction.5ce06618.js";import{_ as b,r as S,o as l,c as n,a as e,w as v,v as I,n as w,F as u,e as y,f as k,d as h,t as c,g,h as x}from"./index.34e73fda.js";const P={data(){return{load:!1,disabled:!1,modelName:"",modelPhone:"",modelCompanyId:"",currentPage:1,last_page:1,total:1,per_page:1,companies:[],modelUserId:"",response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,companySearch:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:f,Pagination:C},computed:{},methods:{searchCompany(){clearTimeout(this.timerId),this.companySearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(1,this.companySearch),3e3)):(this.loading=!0,this.companySearch="",localStorage.removeItem("searchCompany"),this.timerId=setTimeout(()=>this.requestApi(this.currentPage),3e3))},openTeams(r){this.$router.push({name:"companyTeams.all",params:{company_id:r}})},showCompany(r){this.$router.push({name:"companies.show",params:{id:r}})},editCompany(r){this.$router.push({name:"companies.edit",params:{id:r}})},openmodel(r,o){this.modelCompanyId=r,this.modelName=o,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},onPageChange(r){console.log(r),this.currentPage=r,this.loading=!0,this.requestApi(r,localStorage.getItem("searchCompany"))},refreshList(){this.loading=!0,localStorage.removeItem("search"),this.companySearch="",this.requestApi(1)},async exportComp(){if(!this.load){this.load=!0;const r={export:""},o=_(),d=Object.assign(r,o);try{let i=localStorage.getItem("token");const a=await(await fetch(this.url+"api/v1/company/export",{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+i},responseType:"blob"})).blob(),m=window.URL.createObjectURL(new Blob([a])),s=document.createElement("a");s.href=m,s.setAttribute("download","companyExport.xlsx"),document.body.appendChild(s),s.click(),setTimeout(()=>{this.load=!1},2e3)}catch(i){alert(i),console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",i)}}},async requestApiDelete(){this.disabled=!0;const r={company_id:this.modelCompanyId},o=_(),d=Object.assign(r,o);try{let i=localStorage.getItem("token");const a=await(await fetch(this.url+"api/v1/company/delete",{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+i}})).json();a.error?typeof a.message=="object"?this.resError=a.message:this.resStringError=a.message:(this.resSuccess="Successfully Deleted",this.submitButton=!1)}catch(i){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",i)}},requestApi(r,o=null){console.log(r,o),localStorage.setItem("currentPageCompany",r),this.currentPage=r;let d=this.url+"api/v1/company/show/all?page="+r;o&&(o!=localStorage.getItem("searchCompany")?(localStorage.setItem("searchCompany",o),d=this.url+"api/v1/company/show/all?page=1&search="+o):d=this.url+"api/v1/company/show/all?page="+r+"&search="+o);let i=localStorage.getItem("token");fetch(d,{method:"GET",headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+i}}).then(t=>(t.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),t.json())).then(t=>{localStorage.setItem("companyList",JSON.stringify(t)),this.response=t.companies,this.last_page=t.companies.last_page,this.total=t.companies.total,this.per_page=t.companies.per_page,this.companies=t.companies.data,console.log(t.companies),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},created(){this.userInfo=JSON.parse(localStorage.getItem("user")),console.log(this.userInfo);const r=localStorage.getItem("currentPageCompany");this.currentPage=1,r&&(this.currentPage=parseInt(r));const o=localStorage.getItem("searchCompany");o?(this.companySearch=o,this.requestApi(this.currentPage,o)):this.requestApi(this.currentPage)}},T={class:"row"},A={class:"col-md-8"},E={class:"col-md-2"},j=g(" Export"),q={class:"col-md-2"},N=e("i",{class:"ti ti-reload"},null,-1),B=g(" refresh list"),L=[N,B],D={class:"mt-3"},O={class:"row"},z={class:"col-12"},U={class:"table-responsive"},M={class:"table"},V=e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"City"),e("th",{scope:"col"},"District"),e("th",{scope:"col"},"Address line"),e("th",{scope:"col"},"Created at"),e("th",{scope:"col"},"Actions")])],-1),J={class:"actions"},R=["onClick"],F=e("i",{class:"ti ti-user","data-toggle":"tooltip",title:"Teams"},null,-1),G=[F],H=["onClick"],K=e("i",{class:"ti ti-eye","data-toggle":"tooltip",title:"Show"},null,-1),Q=[K],W=["onClick"],X=e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1),Y=[X],Z=["onClick"],ee=e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Delete"},null,-1),te=[ee],se={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},oe={class:"modal-dialog",role:"document"},re={class:"modal-content"},ae=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete Company"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1),ie={class:"modal-body text-center"},le={class:"error"},ne={key:1,class:"error"},ce={key:2,class:"success"},de=e("h4",null,"Are you sure you want to delete this Company?",-1),he={class:"modal-footer"},pe=e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1),me=["disabled"],ue={key:0,class:"loading"},ge=e("img",{src:x},null,-1),_e=[ge];function ye(r,o,d,i,t,a){const m=S("Pagination");return l(),n(u,null,[e("div",T,[e("div",A,[v(e("input",{type:"search",onInput:o[0]||(o[0]=(...s)=>a.searchCompany&&a.searchCompany(...s)),"onUpdate:modelValue":o[1]||(o[1]=s=>t.companySearch=s),class:"form-control",placeholder:"Search: PharmIq"},null,544),[[I,t.companySearch]])]),e("div",E,[e("div",{class:"export",onClick:o[2]||(o[2]=(...s)=>a.exportComp&&a.exportComp(...s))},[e("i",{class:w(["ti",{"ti-export":!t.load,"ti-reload anim":t.load}])},null,2),j])]),e("div",q,[e("div",{class:"refresh",onClick:o[3]||(o[3]=(...s)=>a.refreshList&&a.refreshList(...s))},L)])]),e("div",D,[e("div",O,[e("div",z,[e("div",U,[e("table",M,[V,e("tbody",null,[(l(!0),n(u,null,y(t.companies,s=>(l(),n("tr",{key:s.id},[e("td",null,[g(c(s.companyName)+" ",1),e("span",null,"("+c(s.companymembers.length)+")",1)]),e("td",null,c(s.companyadress&&s.companyadress.city?s.companyadress.city.name_ru:"-"),1),e("td",null,c(s.companyadress&&s.companyadress.region?s.companyadress.region.name_ru:"-"),1),e("td",null,c(s.companyadress?s.companyadress.addressline1:"-"),1),e("td",null,c(new Date(s.created_at).toLocaleString()),1),e("td",J,[e("div",{href:"#",onClick:p=>a.openTeams(s.id),class:"show text-primary cursor-pointer mr-2"},G,8,R),e("div",{href:"#",onClick:p=>a.showCompany(s.id),class:"show text-primary cursor-pointer mr-2"},Q,8,H),t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),n("div",{key:0,href:"#",onClick:p=>a.editCompany(s.id),class:"edit cursor-pointer mr-2"},Y,8,W)):h("",!0),t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),n("div",{key:1,href:"#","data-toggle":"modal","data-target":"#exampleModal",onClick:p=>a.openmodel(s.id,s.companyName),class:"delete text-danger"},te,8,Z)):h("",!0)])]))),128))])])]),k(m,{"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":t.currentPage,onPagechanged:a.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])])])]),e("div",se,[e("div",oe,[e("div",re,[ae,e("div",ie,[t.resError?(l(!0),n(u,{key:0},y(t.resError,(s,p)=>(l(),n("p",le,c(p)+" : "+c(s[0]),1))),256)):h("",!0),t.resStringError?(l(),n("p",ne,c(t.resStringError),1)):h("",!0),t.resSuccess?(l(),n("p",ce,c(t.resSuccess),1)):h("",!0),de,e("h3",null,c(t.modelName),1)]),e("div",he,[pe,t.submitButton?(l(),n("button",{key:0,disabled:t.disabled,type:"button",onClick:o[4]||(o[4]=(...s)=>a.requestApiDelete&&a.requestApiDelete(...s)),class:"btn btn-primary"},"Delete User",8,me)):h("",!0)])])])]),t.loading?(l(),n("div",ue,_e)):h("",!0)],64)}const Se=b(P,[["render",ye]]);export{Se as default};
