import{G as S}from"./GoBackButton.8ec57f12.js";import{u as A,r as _,m as j,a as C}from"./index.esm.b21b73c4.js";import{_ as E,r as x,o as t,c as n,f as T,a as r,F as p,e as m,d as h,t as c,l as O,w as y,v as f,n as g,p as v,g as b}from"./index.34e73fda.js";import{s as N}from"./globalFunction.5ce06618.js";const V={setup(){return{v$:A()}},components:{GoBackButton:S},data(){return{url:"https://api.pharmiq.uz/",companyName:"",longitude:"",latitude:"",addressline1:"",owner:null,city:{},cities:{},region:{},regions:{},user:{},company:{},companyAddress:{},companyHistory:{},companyMembers:{},resStringError:"",resError:!1,resSuccess:!1,resSuccessOwner:!1}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{companyName:{required:_,minLengthValue:j(6),maxLengthValue:C(30)},city:{required:_},region:{required:_},longitude:{regex:/^[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)*$/},latitude:{regex:/^[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)*$/},addressline1:{required:_}}},methods:{getRegions(){this.getRegionApi(this.city)},async getNewOwner(){console.log(this.owner);const u={user_id:this.owner,company_id:this.company.id},o=N(),i=Object.assign(u,o);try{const s=await(await fetch(this.url+"api/v1/company/update/owner",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")}})).json();s.error?(window.scrollTo({top:0,behavior:"smooth"}),typeof s.message=="object"?this.resError=s.message:this.resStringError=s.message):(this.companyMembers=s.companyMembers,this.user=s.user,this.resSuccessOwner="Successfully updated")}catch(l){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",l)}},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApiEdit()},trimFirstNameFunction(){this.companyName=this.companyName.trim()},async requestApiEdit(){const u={company_id:this.$route.params.id,companyName:this.companyName,city_id:this.city,region_id:this.region,gender:this.gender,longitude:this.longitude,latitude:this.latitude,addressline1:this.addressline1},o=N(),i=Object.assign(u,o);try{let l=localStorage.getItem("token");const s=await fetch(this.url+"api/v1/company/update",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+l}}),a=await s.json();window.scrollTo({top:0,behavior:"smooth"}),s.status==401?this.resStringError=a.message:a.error?typeof a.message=="object"?this.resError=a.message:this.resStringError=a.message:(this.company=a.company,this.companyName=a.company.companyName,this.longitude=a.company.companyadress.longitude,this.latitude=a.company.companyadress.latitude,this.addressline1=a.company.companyadress.addressline1,this.companyAddress=a.company.companyadress,this.city=a.company.companyadress.city_id,this.region=a.company.companyadress.region_id,this.getRegionApi(a.company.companyadress.city_id),this.resSuccess="Successfully updated",setTimeout(()=>{this.resSuccess=!1},3e3))}catch{}},async requestApi(){try{let u=localStorage.getItem("token");const o=await fetch(this.url+"api/v1/company/show/all?company_id="+this.$route.params.id,{method:"GET",headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+u}}),i=await o.json(),l=o.status;window.scrollTo({top:0,behavior:"smooth"}),l==401?this.resStringError=i.message:i.error?this.resStringError=i.message:(this.company=i.company,this.companyName=i.company.companyName,this.longitude=i.companyAddress.longitude,this.latitude=i.companyAddress.latitude,this.addressline1=i.companyAddress.addressline1,this.companyAddress=i.companyAddress,this.city=i.companyAddress.city_id,this.region=i.companyAddress.region_id,this.companyHistory=i.companyHistory,this.companyMembers=i.companyMembers,this.user=i.user,this.getRegionApi(i.companyAddress.city_id))}catch(u){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",u)}},async getCityApi(){try{const o=await(await fetch(this.url+"api/v1/show/cities",{method:"GET",headers:{"Content-Type":"application/json",accept:"application/json"}})).json();window.scrollTo({top:0,behavior:"smooth"}),o.error?this.resStringError=o.message:this.cities=o}catch(u){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",u)}},async getRegionApi(u){try{const i=await(await fetch(this.url+"api/v1/show/regions/"+u,{method:"GET",headers:{"Content-Type":"application/json",accept:"application/json"}})).json();window.scrollTo({top:0,behavior:"smooth"}),i.error?this.resStringError=i.message:this.regions=i}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",o)}}},created(){this.requestApi(),this.getCityApi()}},L={class:"row mt-2"},B={class:"col-md-12"},I={class:"card"},R={class:"card-body"},M={class:"error"},F={key:1,class:"error"},U={key:2,class:"success"},q={class:"form-group row"},G={class:"col-md-12"},z=r("label",{for:"exampleInputUsername1"},"Company Name",-1),D={class:"col-md-6"},H=r("label",{for:"exampleInputLastName"},"Longitude",-1),J={class:"col-md-6"},P=r("label",{for:"exampleInputLastName"},"Latitude",-1),K={class:"form-group row"},Q={class:"col-md-4"},W={class:"form-group"},X=r("label",{for:"CityChoose"},"City",-1),Y=["onSelect","value"],Z={class:"col-md-4"},$={class:"form-group"},ee=r("label",{for:"RegionChoose"},"Region",-1),se=["value"],oe={class:"col-md-4"},re=r("label",{for:"exampleInputaddressline1"},"Address",-1),te=["disabled"],ne={class:"col-md-12 mt-4"},ie={class:"card"},ae={class:"card-body"},le={key:0,class:"success"},ce={class:"card-title"},de=b("Company Members ( Owner: "),ue={key:0},pe=b(")"),me={key:1},he=["value"],ye={key:0,href:"tel:"},ge={key:2};function _e(u,o,i,l,s,a){const w=x("GoBackButton");return t(),n(p,null,[T(w),r("div",null,[r("div",L,[r("div",B,[r("div",I,[r("div",R,[s.resError?(t(!0),n(p,{key:0},m(s.resError,(e,d)=>(t(),n("p",M,c(d)+" : "+c(e[0]),1))),256)):h("",!0),s.resStringError?(t(),n("p",F,c(s.resStringError),1)):h("",!0),s.resSuccess?(t(),n("p",U,c(s.resSuccess),1)):h("",!0),r("form",{class:"forms-sample",onSubmit:o[9]||(o[9]=O(e=>a.submitForm(),["prevent"]))},[r("div",q,[r("div",G,[z,y(r("input",{type:"text",class:g(["form-control",{"border border-danger":l.v$.companyName.$errors.length>0}]),onInput:o[0]||(o[0]=(...e)=>a.trimFirstNameFunction&&a.trimFirstNameFunction(...e)),"onUpdate:modelValue":o[1]||(o[1]=e=>s.companyName=e),id:"exampleInputUsername1",placeholder:"Company Name"},null,34),[[f,s.companyName]]),(t(!0),n(p,null,m(l.v$.companyName.$errors,(e,d)=>(t(),n("small",{class:"error",key:d},c(e.$message),1))),128))]),r("div",D,[H,y(r("input",{type:"number",class:g(["form-control",{"border border-danger":l.v$.longitude.$errors.length>0}]),step:"any","onUpdate:modelValue":o[2]||(o[2]=e=>s.longitude=e),id:"exampleInputLastName",placeholder:"Longitude"},null,2),[[f,s.longitude]]),(t(!0),n(p,null,m(l.v$.longitude.$errors,(e,d)=>(t(),n("small",{class:"error",key:d},c(e.$message),1))),128))]),r("div",J,[P,y(r("input",{type:"number",class:g(["form-control",{"border border-danger":l.v$.latitude.$errors.length>0}]),step:"any","onUpdate:modelValue":o[3]||(o[3]=e=>s.latitude=e),id:"exampleInputLastName",placeholder:"Latitude"},null,2),[[f,s.latitude]]),(t(!0),n(p,null,m(l.v$.latitude.$errors,(e,d)=>(t(),n("small",{class:"error",key:d},c(e.$message),1))),128))])]),r("div",K,[r("div",Q,[r("div",W,[X,y(r("select",{class:g(["form-control",{"border border-danger":l.v$.city.$errors.length>0}]),required:"",onChange:o[4]||(o[4]=(...e)=>a.getRegions&&a.getRegions(...e)),"onUpdate:modelValue":o[5]||(o[5]=e=>s.city=e),id:"CityChoose"},[(t(!0),n(p,null,m(s.cities,(e,d)=>(t(),n(p,{key:e.id},[d<14?(t(),n("option",{key:0,onSelect:k=>e.id==s.city,value:e.id},c(e.name_ru),41,Y)):h("",!0)],64))),128))],34),[[v,s.city]]),(t(!0),n(p,null,m(l.v$.city.$errors,(e,d)=>(t(),n("small",{class:"error",key:d},c(e.$message),1))),128))])]),r("div",Z,[r("div",$,[ee,y(r("select",{class:g(["form-control",{"border border-danger":l.v$.region.$errors.length>0}]),required:"","onUpdate:modelValue":o[7]||(o[7]=e=>s.region=e),id:"RegionChoose"},[(t(!0),n(p,null,m(s.regions,(e,d)=>(t(),n("option",{key:e.id,onSelect:o[6]||(o[6]=k=>u.reg.id==s.region),value:e.id},c(e.name_ru),41,se))),128))],2),[[v,s.region]]),(t(!0),n(p,null,m(l.v$.region.$errors,(e,d)=>(t(),n("small",{class:"error",key:d},c(e.$message),1))),128))])]),r("div",oe,[re,y(r("input",{type:"text",class:g(["form-control",{"border border-danger":l.v$.addressline1.$errors.length>0}]),step:"any","onUpdate:modelValue":o[8]||(o[8]=e=>s.addressline1=e),id:"exampleInputaddressline1",placeholder:"Address"},null,2),[[f,s.addressline1]]),(t(!0),n(p,null,m(l.v$.addressline1.$errors,(e,d)=>(t(),n("small",{class:"error",key:d},c(e.$message),1))),128))])]),r("button",{type:"submit",disabled:a.isDisabled,class:"btn btn-primary mr-2"},"Update",8,te)],32)])])]),r("div",ne,[r("div",ie,[r("div",ae,[s.resSuccessOwner?(t(),n("p",le,c(s.resSuccessOwner),1)):h("",!0),r("h5",ce,[de,s.user?(t(),n("span",ue,c(s.user.firstName)+" "+c(s.user.lastName),1)):h("",!0),pe]),s.companyMembers.length>0?(t(),n("div",me,[y(r("select",{class:"form-control",onChange:o[10]||(o[10]=(...e)=>a.getNewOwner&&a.getNewOwner(...e)),"onUpdate:modelValue":o[11]||(o[11]=e=>s.owner=e)},[(t(!0),n(p,null,m(s.companyMembers,e=>(t(),n(p,null,[e.user&&e.user.phonebook?(t(),n("option",{key:0,value:e.user.hrid},[b(c(e.user?e.user.firstName:"")+" "+c(e.user?e.user.lastName:"")+", ",1),e.user&&e.user.phonebook?(t(),n("a",ye,c("+"+e.user.phonebook.phoneNumber.substring(0,3)+" ( "+e.user.phonebook.phoneNumber.substring(3,5)+" ) "+e.user.phonebook.phoneNumber.substring(5,8)+"-"+e.user.phonebook.phoneNumber.substring(8,10)+"-"+e.user.phonebook.phoneNumber.substring(10,12)),1)):h("",!0)],8,he)):h("",!0)],64))),256))],544),[[v,s.owner]])])):(t(),n("p",ge,"Empty"))])])])])])],64)}const Ne=E(V,[["render",_e]]);export{Ne as default};
