import{G as w}from"./GoBackButton.8ec57f12.js";import{c as S}from"./vue-datepicker.es.17b3f44e.js";import{h as T}from"./maska.esm.cd315c5a.js";import{u as I,r as C,m as z,b as v}from"./index.esm.b21b73c4.js";import{_ as j,a4 as B,a5 as L,r as E,o as a,c as l,f as G,a as i,F as p,e as _,d as g,t as m,l as x,w as y,v as k,n as f,a0 as q,p as b,a2 as A,a3 as U}from"./index.34e73fda.js";import{s as M}from"./globalFunction.5ce06618.js";const N={setup(){return{v$:I()}},directives:{maska:T},components:{GoBackButton:w,Datepicker:S,yandexMap:B,ymapMarker:L},data(){return{url:"https://api.pharmiq.uz/",hideGroups:!0,city_id:14,region_id:192,groups:[],companyName:"",companyId:0,banner_ru:[],banner_ru_prev:null,banner_uz:[],banner_uz_prev:null,title_ru:"",title_uz:"",body_ru:"",startDate:null,endDate:null,body_uz:"",categories:[],added:!1,resError:!1,resSuccess:!1,resStringError:"",userInfo:null,monetized:!1,price:0,category_id:1,storeLandmark_ru:"",storeLandmark_uz:"",lat:null,long:null,cities:[],regions:[]}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{title_ru:{required:C,minLengthValue:z(5)},city_id:{required:v(()=>this.hideGroups)},region_id:{required:v(()=>this.hideGroups)},storeLandmark_ru:{required:v(()=>this.hideGroups)}}},methods:{onChangeCities(n){this.getRegions(n.target.value)},getGroups(){let n=this.url+"api/v1/groups?page=1",t=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(n,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.groups=e.data,this.groups.length>0&&(this.group_id=this.groups[0].id)})},getAddressByCoor(n,t){this.lat=n,this.long=t;let c=this.url+"api/v1/getAdressByCoor?lat="+n+"&long="+t,e=localStorage.getItem("token");const r={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e})};fetch(c,r).then(o=>(o.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{console.log(o),this.storeLandmark_ru="",this.storeLandmark_uz="",o.city&&o.region.id&&(this.city_id=o.city.id,this.getRegions(14,o.region.id)),o.street||o.house?(o.street&&(this.storeLandmark_ru+=o.street),o.house&&(this.storeLandmark_ru+=" "+o.house)):(o.other&&(this.storeLandmark_ru+=" "+o.other),o.area&&(this.storeLandmark_ru+=" "+o.area))})},async requestApi(){const n={company_id:this.$route.params.company_id,team_id:this.$route.params.team_id,teamName:this.title_ru,teamType:this.monetized?1:0},t=M(),c=Object.assign(n,t);var e=new FormData;for(const r in c)e.append(r,c[r]);this.monetized==!1&&(e.append("city_id",this.city_id),e.append("region_id",this.region_id),e.append("addressType",1),e.append("addressline",this.storeLandmark_ru),this.lat&&this.long&&(e.append("latitude",this.lat),e.append("longitude",this.long)));try{let r=localStorage.getItem("token");const o=await fetch(this.url+"api/v1/company/team/update",{method:"POST",body:e,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+r}}),h=await o.json();window.scrollTo({top:0,behavior:"smooth"}),o.status==401?this.resStringError=h.message:h.error?typeof h.message=="object"?this.resError=h.message:this.resStringError=h.message:this.resSuccess="Company Team Successfully Added"}catch(r){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",r)}},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},getvalue(){this.monetized?this.hideGroups=!1:(this.hideGroups=!0,this.showmap())},getCompanyById(){let n=this.url+"api/v1/company/getCompanyId/"+this.$route.params.company_id,t=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(n,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{e!=null&&(this.companyId=e.id,this.companyName=e.companyName)})},getCities(){let n=this.url+"api/v1/show/cities",t=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(n,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.cities=e})},getRegions(n,t){let c=this.url+"api/v1/show/regions/"+n,e=localStorage.getItem("token");const r={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e})};fetch(c,r).then(o=>(o.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{this.regions=o,t?this.region_id=t:this.region_id=o[0]!==void 0?o[0].id:null})},showmap(){ymaps.ready(n=>{var t=new ymaps.Map("map",{center:[41.311081,69.240562],zoom:11},{searchControlProvider:"yandex#search"});t.events.add("click",c=>{if(t.balloon.isOpen())t.balloon.close();else{var e=c.get("coords");t.balloon.open(e,{contentBody:"<p>Coordinates: "+[e[0].toPrecision(6),e[1].toPrecision(6)].join(", ")+"</p>",contentFooter:"<sup>Click again</sup>"}),this.getAddressByCoor(e[0],e[1])}})})},getTeam(){let n=this.url+"api/v1/company/team/show/"+this.$route.params.company_id+"?team_id="+this.$route.params.team_id,t=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(n,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{e.companyTeams?(console.log(e.company_team_address),this.title_ru=e.companyTeams.teamName,this.monetized=e.companyTeams.teamType,this.getvalue(),e.companyTeams.company_team_address&&(this.city_id=e.companyTeams.company_team_address.city_id,this.region_id=e.companyTeams.company_team_address.region_id,this.storeLandmark_ru=e.companyTeams.company_team_address.addressline,this.long=e.companyTeams.company_team_address.longitude,this.lat=e.companyTeams.company_team_address.latitude,this.getRegions(this.city_id,this.region_id))):this.resStringError="Team not found"})}},created(){this.userInfo=JSON.parse(localStorage.getItem("user")),this.getCompanyById(),this.getTeam(),this.getCities(),this.getRegions(14),this.showmap()}},d=n=>(A("data-v-e6fbc328"),n=n(),U(),n),R={class:"mt-3"},V={class:"row"},D={class:"col-md-12 grid-margin stretch-card"},F={class:"card"},H={class:"card-body"},$=d(()=>i("h4",{class:"card-title"},"Edit Team",-1)),O={class:"error"},P={key:1,class:"error"},J={key:2,class:"success"},K=d(()=>i("div",{class:"form-group row"},null,-1)),Q={class:"form-group row"},W={class:"col-md-6"},X=d(()=>i("label",{for:"exampleInputTitleRu"},"Team Name",-1)),Y={class:"col-md-6 text-center"},Z=d(()=>i("label",{for:"exampleInputstartRu"},"Team Type",-1)),ee=d(()=>i("br",null,null,-1)),te={class:"language-switcher"},oe=d(()=>i("span",{class:"slider round"},null,-1)),se=d(()=>i("span",{class:"select-ru"},"Branch",-1)),re=d(()=>i("span",{class:"select-uz"},"Special",-1)),ie={class:"form-group row"},ne={key:0,class:"col-md-12 mt-4"},ae=d(()=>i("div",{id:"map",style:{"min-width":"95%",height:"400px",overflow:"hidden"}},null,-1)),le=[ae],ce={key:0,class:"form-group row"},de={class:"col-md-6"},me=d(()=>i("label",{class:"col-sm-3",for:"banner"},"Cities",-1)),ue=["value"],pe={class:"col-md-6"},he=d(()=>i("label",{class:"col-sm-3",for:"banner"},"Regions",-1)),_e=["value"],ge={class:"col-md-12"},ye=d(()=>i("label",{for:"exampleInputLandMark"},"Street, house",-1)),fe=["disabled"];function ve(n,t,c,e,r,o){const h=E("GoBackButton");return a(),l(p,null,[G(h),i("div",R,[i("div",V,[i("div",D,[i("div",F,[i("div",H,[$,r.resError?(a(!0),l(p,{key:0},_(r.resError,(s,u)=>(a(),l("p",O,m(u)+" : "+m(s[0]),1))),256)):g("",!0),r.resStringError?(a(),l("p",P,m(r.resStringError),1)):g("",!0),r.resSuccess?(a(),l("p",J,m(r.resSuccess),1)):g("",!0),i("form",{class:"forms-sample",onSubmit:t[7]||(t[7]=x(s=>o.submitForm(),["prevent"]))},[K,i("div",Q,[i("div",W,[X,y(i("input",{type:"text",class:f(["form-control",{"border border-danger":e.v$.title_ru.$errors.length>0}]),id:"exampleInputTitleRu","onUpdate:modelValue":t[0]||(t[0]=s=>r.title_ru=s)},null,2),[[k,r.title_ru]]),(a(!0),l(p,null,_(e.v$.title_ru.$errors,(s,u)=>(a(),l("small",{class:"error",key:u},m(s.$message),1))),128))]),i("div",Y,[Z,ee,i("label",te,[y(i("input",{onChange:t[1]||(t[1]=(...s)=>o.getvalue&&o.getvalue(...s)),type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>r.monetized=s)},null,544),[[q,r.monetized]]),oe,se,re])])]),i("div",ie,[r.hideGroups?(a(),l("div",ne,le)):g("",!0)]),r.hideGroups?(a(),l("div",ce,[i("div",de,[me,y(i("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.city_id=s),onChange:t[4]||(t[4]=s=>o.onChangeCities(s)),class:f(["form-control",{"border border-danger":e.v$.city_id.$errors.length>0}])},[(a(!0),l(p,null,_(r.cities.slice(0,14),s=>(a(),l(p,{key:s.id},[s?(a(),l("option",{key:0,value:s.id},m(s.name_ru),9,ue)):g("",!0)],64))),128))],34),[[b,r.city_id]]),(a(!0),l(p,null,_(e.v$.city_id.$errors,(s,u)=>(a(),l("small",{class:"error",key:u},m(s.$message),1))),128))]),i("div",pe,[he,y(i("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>r.region_id=s),class:f(["form-control",{"border border-danger":e.v$.region_id.$errors.length>0}])},[(a(!0),l(p,null,_(r.regions,s=>(a(),l("option",{key:s.id,value:s.id},m(s.name_ru),9,_e))),128))],2),[[b,r.region_id]]),(a(!0),l(p,null,_(e.v$.region_id.$errors,(s,u)=>(a(),l("small",{class:"error",key:u},m(s.$message),1))),128))]),i("div",ge,[ye,y(i("input",{type:"text",class:f(["form-control",{"border border-danger":e.v$.storeLandmark_ru.$errors.length>0}]),placeholder:"Street, house",id:"exampleInputLandMark","onUpdate:modelValue":t[6]||(t[6]=s=>r.storeLandmark_ru=s)},null,2),[[k,r.storeLandmark_ru]]),(a(!0),l(p,null,_(e.v$.storeLandmark_ru.$errors,(s,u)=>(a(),l("small",{class:"error",key:u},m(s.$message),1))),128))])])):g("",!0),r.added?g("",!0):(a(),l("button",{key:1,type:"submit",disabled:o.isDisabled,class:"btn btn-primary mr-2"},"Update",8,fe))],32)])])])])])],64)}const Ce=j(N,[["render",ve],["__scopeId","data-v-e6fbc328"]]);export{Ce as default};
