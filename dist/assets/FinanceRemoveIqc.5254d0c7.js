import{s as b}from"./globalFunction.5ce06618.js";import{_ as S,o as a,c as l,a as t,n as y,w as p,v as _,F as m,t as c,d as k,e as f,a0 as N}from"./index.34e73fda.js";const q={data(){return{url:"https://api.pharmiq.uz/",loading:!0,userInfo:null,search:"",iqc:0,notify:!1,searchby:0,comment:"removed",search_p:"Search: 998991112233",search_g:"Search: Target Group Name",removeIqcUser:[],selectedUserId:null,selectedPhoneNumber:null,selectedGroupId:null,selectedGroupName:null,listRemovedIqcUsers:[],clicked:!1}},components:{},computed:{},watch:{totalMessage:function(){this.dataMailing.datasets[0].data=[this.totalMessage,this.counterMailing]}},methods:{searchInput(){this.searchby==0?(this.search=this.search.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/g,"$1"),this.search.length>=4&&this.requestApiSearch(1,this.search)):this.search.length>=3&&this.requestApiSearch(1,this.search)},selectUserGroup(i,o){this.searchby==0?(this.selectedUserId=i,this.selectedPhoneNumber=o,this.removeIqcUser=[]):(this.selectedGroupId=i,this.selectedGroupName=o,this.removeIqcUserGroups=[])},async submitRemoveForm(){if(this.iqc!=0&&(this.selectedUserId||this.selectedGroupId)){if(this.clicked)return;this.clicked=!0;const o={searchby:this.searchby,selectedUserId:this.selectedUserId,selectedGroupId:this.selectedGroupId,iqc:this.iqc,comment:this.comment,notify:this.notify?1:0},h=b(),n=Object.assign(o,h);var i=new FormData;for(const s in n)i.append(s,n[s]);try{let s=localStorage.getItem("token");const r=await fetch(this.url+"api/v1/admin/remove-iqc-users-group",{method:"POST",body:i,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+s}}),e=await r.json();window.scrollTo({top:0,behavior:"smooth"}),r.status==401?this.resStringError=e.message:e.error&&(typeof e.message=="object"?this.resError=e.message:this.resStringError=e.message),this.clicked=!1,this.selectedUserId=null,this.selectedPhoneNumber=null,this.removeIqcUser=[],this.selectedGroupId=null,this.selectedGroupName=null,this.removeIqcUserGroups=[],this.getRemovedIqcUsers()}catch(s){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",s),this.clicked=!1}}},requestApiSearch(i,o=null){let h=this.url+"api/v1/admin/show/users?page=1&search="+o;this.searchby==1&&(h=this.url+"api/v1/admin/show/groups?page=1&search="+o);let n=localStorage.getItem("token");const s={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n})};fetch(h,s).then(r=>(r.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),r.json())).then(r=>{this.searchby==1?this.removeIqcUserGroups=r.data:this.removeIqcUser=r.data,window.scrollTo({top:0,behavior:"smooth"})})},async requestApi(i,o=null){this.loading=!0;const h={start_date:this.start_date?this.start_date.replace("T"," "):this.start_dateC,end_date:this.end_date?this.end_date.replace("T"," "):this.end_dateC},n=b(),s=Object.assign(h,n);var r=new FormData;for(const e in s)r.append(e,s[e]);try{let e=localStorage.getItem("token");const u=await fetch(this.url+"api/v1/admin/statistics/finance/date",{method:"POST",body:r,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+e}}),d=await u.json();if(window.scrollTo({top:0,behavior:"smooth"}),u.status==401)this.resStringError=d.message,this.added=!1;else if(d.error)typeof d.message=="object"?this.resError=d.message:this.resStringError=d.message,this.added=!1;else{let v=[],g=[];Object.entries(d.userGraph).map(([w,I]=entry)=>{v.push(w),g.push(I.iqc)}),this.chartData.labels=v,this.chartData.datasets=[{label:"IQC Transactins",borderColor:"red",backgroundColor:"#f87979",data:g}],window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)}}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",e)}},openmodel(i,o){this.modelUserId=i,this.modelName=o,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},async getRemovedIqcUsers(){let i=this.url+"api/v1/admin/statistics/removed-iqc-users",o=localStorage.getItem("token");const h={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+o})};fetch(i,h).then(n=>(n.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),n.json())).then(n=>{this.listRemovedIqcUsers=n,console.log(n),window.scrollTo({top:0,behavior:"smooth"})})}},mounted(){this.$i18n.locale="ru"},created(){this.userInfo=JSON.parse(localStorage.getItem("user")),this.getRemovedIqcUsers()}},T={class:"row"},U={class:"col-md-6"},G={class:"filterType"},C=t("div",{class:"filterType__text"},"Searcb by:",-1),j={class:"row"},x={class:"col-md-12"},A=["placeholder"],E={class:"row mt-2"},R={class:"col-md-12"},F={key:0,class:"selected"},z={key:0,class:"selected"},P={key:2,class:"list"},B=["onClick"],D={key:3,class:"list"},M=["onClick"],L={class:"row mt-3"},O={class:"col-md-4"},V={class:"col-md-4"},Q={class:"col-md-2 filterType text-center",style:{"justify-content":"center"}},H=t("span",{class:"mr-2"},"Notify",-1),J=["checked"],Y={class:"col-md-2 filterType"},K={class:"row mt-3"},W={class:"col-md-12"},X={class:"table-responsive"},Z=t("h5",null,"Last 20 IQC Transactions",-1),ee={class:"table"},te=t("thead",{class:"thead-dark"},[t("tr",null,[t("th",{scope:"col"},"Phone number"),t("th",{scope:"col"},"First name"),t("th",{scope:"col"},"Last name"),t("th",{scope:"col"},"IQC"),t("th",{scope:"col"},"Notify"),t("th",{scope:"col"},"Removed at")])],-1);function se(i,o,h,n,s,r){return a(),l("div",null,[t("div",T,[t("div",U,[t("div",G,[C,t("div",{class:y(["filterType__buttons btn btn-primary",{active:s.searchby==0}]),onClick:o[0]||(o[0]=e=>s.searchby=0)},"PhoneNumber",2),t("div",{class:y(["filterType__buttons btn btn-primary",{active:s.searchby==1}]),onClick:o[1]||(o[1]=e=>s.searchby=1)},"Group",2)])])]),t("div",j,[t("div",x,[p(t("input",{type:"search",onInput:o[2]||(o[2]=(...e)=>r.searchInput&&r.searchInput(...e)),"onUpdate:modelValue":o[3]||(o[3]=e=>s.search=e),class:"form-control",placeholder:s.searchby?s.search_g:s.search_p},null,40,A),[[_,s.search]])])]),t("div",E,[t("div",R,[s.searchby==0?(a(),l(m,{key:0},[s.selectedPhoneNumber?(a(),l("div",F,c(s.selectedPhoneNumber),1)):k("",!0)],64)):(a(),l(m,{key:1},[s.selectedGroupName?(a(),l("div",z,c(s.selectedGroupName),1)):k("",!0)],64)),s.searchby==0?(a(),l("div",P,[(a(!0),l(m,null,f(s.removeIqcUser,e=>(a(),l("div",{class:"list__each",onClick:u=>r.selectUserGroup(e.phonebook.user_id,e.phonebook.phoneNumber)},c("+"+e.phonebook.phoneNumber)+": "+c(e.firstName)+" "+c(e.lastName),9,B))),256))])):(a(),l("div",D,[(a(!0),l(m,null,f(i.removeIqcUserGroups,e=>(a(),l("div",{class:"list__each",onClick:u=>r.selectUserGroup(e.id,e.groupName)},c(e.groupName),9,M))),256))]))])]),t("div",L,[t("div",O,[p(t("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=e=>s.iqc=e),class:"form-control text-center"},null,512),[[_,s.iqc]])]),t("div",V,[p(t("input",{type:"text",maxlength:"5","onUpdate:modelValue":o[5]||(o[5]=e=>s.comment=e),class:"form-control text-center"},null,512),[[_,s.comment]])]),t("div",Q,[H,p(t("input",{type:"checkbox",checked:s.notify,"onUpdate:modelValue":o[6]||(o[6]=e=>s.notify=e),class:"form-control",style:{position:"initial",width:"fit-content"}},null,8,J),[[N,s.notify]])]),t("div",Y,[t("div",{class:"btn btn-primary form-control",onClick:o[7]||(o[7]=(...e)=>r.submitRemoveForm&&r.submitRemoveForm(...e))},"Submit")])]),t("div",K,[t("div",W,[t("div",X,[Z,t("table",ee,[te,t("tbody",null,[(a(!0),l(m,null,f(s.listRemovedIqcUsers,e=>(a(),l("tr",{key:e.id},[t("td",null,c(e.useR.phonebook.phoneNumber),1),t("td",null,c(e.useR.firstName),1),t("td",null,c(e.useR.lastName),1),t("td",null,c(e.iqcTransaction.value),1),t("td",null,c(e.iqcTransaction.notify?"Yes":"No"),1),t("td",null,c(new Date(e.iqcTransaction.created_at).toLocaleString()),1)]))),128))])])])])])])}const ne=S(q,[["render",se]]);export{ne as default};
