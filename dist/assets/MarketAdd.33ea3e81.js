import{G as w}from"./GoBackButton.8ec57f12.js";import{c as I}from"./vue-datepicker.es.17b3f44e.js";import{h as x}from"./maska.esm.cd315c5a.js";import{u as z,r as _,m as y}from"./index.esm.b21b73c4.js";import{_ as S,a4 as D,a5 as T,r as U,o as n,c as a,f as j,a as o,F as u,e as p,d as b,t as c,l as B,w as k,p as L,n as g,v as f,a2 as O,a3 as A}from"./index.34e73fda.js";import{s as M}from"./globalFunction.5ce06618.js";const C={setup(){return{v$:z()}},directives:{maska:x},components:{GoBackButton:w,Datepicker:I,yandexMap:D,ymapMarker:T},data(){return{url:"https://api.pharmiq.uz/",name:"",added:!1,resError:!1,resSuccess:!1,resStringError:"",userInfo:null,descriptionText_ru:"",descriptionText_uz:"",categoryID:null,categories:[],storeOwners:[],storeOwnerID:null,storeLandmark_ru:"",storeLandmark_uz:"",lat:null,long:null}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{descriptionText_ru:{required:_,minLengthValue:y(5)},descriptionText_uz:{required:_,minLengthValue:y(5)},lat:{required:_},long:{required:_},storeOwnerID:{required:_},name:{required:_,minLengthValue:y(3)},storeLandmark_ru:{required:_},storeLandmark_uz:{required:_},categoryID:{required:_}}},methods:{async requestApi(){this.added=!0;const d={storeLatitude:this.lat,storeLongitude:this.long,storeLandmark_ru:this.storeLandmark_ru,storeLandmark_uz:this.storeLandmark_uz,storeDescription_ru:this.descriptionText_ru,storeDescription_uz:this.descriptionText_uz,storeName:this.name,category_id:this.categoryID,storeOwner:this.storeOwnerID},t=M(),m=Object.assign(d,t);var r=new FormData;r.append("productIMG",this.banner_ru);for(const s in m)r.append(s,m[s]);try{let s=localStorage.getItem("token");const i=await fetch(this.url+"api/v1/store/add",{method:"POST",body:r,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+s}}),v=await i.json();window.scrollTo({top:0,behavior:"smooth"}),i.status==401?(this.resStringError=v.message,this.added=!1):v.error?(typeof v.message=="object"?this.resError=v.message:this.resStringError=v.message,this.added=!1):this.resSuccess="Store Successfully Added"}catch(s){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",s)}},uploadFilebannerRu(d){var t=d.target.files||d.dataTransfer.files;if(!t.length){this.banner_ru=[],this.banner_ru_prev="";return}this.banner_ru=t[0],this.banner_ru_prev=URL.createObjectURL(t[0])},getAddressByCoor(d,t){this.lat=d,this.long=t;let m=this.url+"api/v1/getAdressByCoor?lat="+d+"&long="+t,r=localStorage.getItem("token");const s={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r})};fetch(m,s).then(i=>(i.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),i.json())).then(i=>{this.storeLandmark_ru="",this.storeLandmark_uz="",i.street||i.house?(i.street&&(this.storeLandmark_ru+=i.street,this.storeLandmark_uz+=i.street),i.house&&(this.storeLandmark_ru+=" "+i.house,this.storeLandmark_uz+=" "+i.house)):(i.other&&(this.storeLandmark_ru+=" "+i.other,this.storeLandmark_uz+=" "+i.other),i.area&&(this.storeLandmark_ru+=" "+i.area,this.storeLandmark_uz+=" "+i.area)),console.log(this.storeLandmark_ru)})},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},requestGetcategories(){let d=this.url+"api/v1/store/category?page=1",t=localStorage.getItem("token");const m={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(d,m).then(r=>(r.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),r.json())).then(r=>{this.categories=r.data})},requestGetStoreOwners(){let d=this.url+"api/v1/store/storeOwner",t=localStorage.getItem("token");const m={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(d,m).then(r=>(r.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),r.json())).then(r=>{this.storeOwners=r.data})}},created(){this.requestGetcategories(),this.requestGetStoreOwners(),ymaps.ready(d=>{var t=new ymaps.Map("map",{center:[41.311081,69.240562],zoom:11},{searchControlProvider:"yandex#search"});console.log(this.lat),t.events.add("click",m=>{if(t.balloon.isOpen())t.balloon.close();else{var r=m.get("coords");t.balloon.open(r,{contentBody:"<p>Coordinates: "+[r[0].toPrecision(6),r[1].toPrecision(6)].join(", ")+"</p>",contentFooter:"<sup>Click again</sup>"}),this.getAddressByCoor(r[0],r[1])}})})}},h=d=>(O("data-v-b55dba26"),d=d(),A(),d),V={class:"mt-3"},E={class:"row"},q={class:"col-md-12 grid-margin stretch-card"},G={class:"card"},$={class:"card-body"},N=h(()=>o("h4",{class:"card-title"},"Add Store",-1)),R={class:"error"},F={key:1,class:"error"},P={key:2,class:"success"},H={class:"form-group row"},J={class:"col-md-6"},K=h(()=>o("label",{for:"banner"},"Category",-1)),Q=h(()=>o("option",{disabled:"",value:"0"},"Please select one",-1)),W=["value"],X={class:"col-md-6"},Y=h(()=>o("label",{for:"banner"},"Store Owner",-1)),Z=h(()=>o("option",{disabled:"",value:"0"},"Please select one",-1)),ee=["value"],re={class:"col-md-12"},te=h(()=>o("label",{for:"exampleInputNameRu"},"Name",-1)),oe={class:"col-md-6"},se=h(()=>o("label",{for:"exampleInputDescriptionRu"},"Description Ru",-1)),ne={class:"col-md-6"},ae=h(()=>o("label",{for:"exampleInputDescriptionUz"},"Description Uz",-1)),ie={class:"col-md-12 mt-4"},le={class:"col-md-6"},de=h(()=>o("label",{for:"exampleInputLandMark"},"Street, house Ru",-1)),ce={class:"col-md-6"},ue=h(()=>o("label",{for:"exampleInputLandMarkUz"},"Street, house Uz",-1)),me=["disabled"];function pe(d,t,m,r,s,i){const v=U("GoBackButton");return n(),a(u,null,[j(v),o("div",V,[o("div",E,[o("div",q,[o("div",G,[o("div",$,[N,s.resError?(n(!0),a(u,{key:0},p(s.resError,(e,l)=>(n(),a("p",R,c(l)+" : "+c(e[0]),1))),256)):b("",!0),s.resStringError?(n(),a("p",F,c(s.resStringError),1)):b("",!0),s.resSuccess?(n(),a("p",P,c(s.resSuccess),1)):b("",!0),o("form",{class:"forms-sample",onSubmit:t[7]||(t[7]=B(e=>i.submitForm(),["prevent"]))},[o("div",H,[o("div",J,[K,k(o("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.categoryID=e),class:g(["form-control",{"border border-danger":r.v$.categoryID.$errors.length>0}])},[Q,(n(!0),a(u,null,p(s.categories,e=>(n(),a("option",{key:e.id,value:e.id},c(JSON.parse(e.name).ru),9,W))),128))],2),[[L,s.categoryID]]),(n(!0),a(u,null,p(r.v$.categoryID.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))]),o("div",X,[Y,k(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.storeOwnerID=e),class:g(["form-control",{"border border-danger":r.v$.storeOwnerID.$errors.length>0}])},[Z,(n(!0),a(u,null,p(s.storeOwners,e=>{var l;return n(),a("option",{key:e.id,value:(l=e.phonebook)==null?void 0:l.user_id},c(e.firstName+" "+e.lastName),9,ee)}),128))],2),[[L,s.storeOwnerID]]),(n(!0),a(u,null,p(r.v$.storeOwnerID.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))]),o("div",re,[te,k(o("input",{type:"text",class:g(["form-control",{"border border-danger":r.v$.name.$errors.length>0}]),placeholder:"Store Name",id:"exampleInputNameRu","onUpdate:modelValue":t[2]||(t[2]=e=>s.name=e)},null,2),[[f,s.name]]),(n(!0),a(u,null,p(r.v$.name.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))]),o("div",oe,[se,k(o("textarea",{rows:"10",type:"text",class:g(["form-control",{"border border-danger":r.v$.descriptionText_ru.$errors.length>0}]),id:"exampleInputDescriptionRu","onUpdate:modelValue":t[3]||(t[3]=e=>s.descriptionText_ru=e)},null,2),[[f,s.descriptionText_ru]]),(n(!0),a(u,null,p(r.v$.descriptionText_ru.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))]),o("div",ne,[ae,k(o("textarea",{rows:"10",type:"text",class:g(["form-control",{"border border-danger":r.v$.descriptionText_uz.$errors.length>0}]),id:"exampleInputDescriptionUz","onUpdate:modelValue":t[4]||(t[4]=e=>s.descriptionText_uz=e)},null,2),[[f,s.descriptionText_uz]]),(n(!0),a(u,null,p(r.v$.descriptionText_uz.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))]),o("div",ie,[o("div",{id:"map",style:{"min-width":"95%",height:"400px",overflow:"hidden"},class:g({"border border-danger":r.v$.lat.$errors.length>0})},null,2),(n(!0),a(u,null,p(r.v$.lat.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},"Select Address in Map"))),128))]),o("div",le,[de,k(o("input",{type:"text",class:g(["form-control",{"border border-danger":r.v$.storeLandmark_ru.$errors.length>0}]),placeholder:"Street, house",id:"exampleInputLandMark","onUpdate:modelValue":t[5]||(t[5]=e=>s.storeLandmark_ru=e)},null,2),[[f,s.storeLandmark_ru]]),(n(!0),a(u,null,p(r.v$.storeLandmark_ru.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))]),o("div",ce,[ue,k(o("input",{type:"text",class:g(["form-control",{"border border-danger":r.v$.storeLandmark_uz.$errors.length>0}]),placeholder:"Street, house",id:"exampleInputLandMarkUz","onUpdate:modelValue":t[6]||(t[6]=e=>s.storeLandmark_uz=e)},null,2),[[f,s.storeLandmark_uz]]),(n(!0),a(u,null,p(r.v$.storeLandmark_uz.$errors,(e,l)=>(n(),a("small",{class:"error",key:l},c(e.$message),1))),128))])]),s.added?b("",!0):(n(),a("button",{key:0,type:"submit",disabled:i.isDisabled,class:"btn btn-primary mr-2"},"Create",8,me))],32)])])])])])],64)}const be=S(C,[["render",pe],["__scopeId","data-v-b55dba26"]]);export{be as default};
