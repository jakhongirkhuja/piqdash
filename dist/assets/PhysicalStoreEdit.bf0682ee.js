import{G as L}from"./GoBackButton.8ec57f12.js";import{c as I}from"./vue-datepicker.es.17b3f44e.js";import{h as z}from"./maska.esm.cd315c5a.js";import{u as S,r as g,m as b}from"./index.esm.b21b73c4.js";import{_ as x,a4 as D,a5 as T,r as O,o as a,c as i,f as U,a as s,F as m,e as p,d as y,t as u,l as j,w as k,p as w,n as v,v as f,a2 as B,a3 as E}from"./index.34e73fda.js";import{s as N}from"./globalFunction.5ce06618.js";const A={setup(){return{v$:S()}},directives:{maska:z},components:{GoBackButton:L,Datepicker:I,yandexMap:D,ymapMarker:T},data(){return{url:"https://api.pharmiq.uz/",name:"",added:!1,resError:!1,resSuccess:!1,resStringError:"",userInfo:null,descriptionText_ru:"",descriptionText_uz:"",categoryID:null,categories:[],storeOwners:[],storeOwnerID:null,storeLandmark_ru:"",storeLandmark_uz:"",lat:null,long:null}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{descriptionText_ru:{required:g,minLengthValue:b(5)},descriptionText_uz:{required:g,minLengthValue:b(5)},lat:{required:g},long:{required:g},storeOwnerID:{required:g},name:{required:g,minLengthValue:b(3)},storeLandmark_ru:{required:g},storeLandmark_uz:{required:g},categoryID:{required:g}}},methods:{async requestApi(){this.added=!0;const c={storeLatitude:this.lat,storeLongitude:this.long,storeLandmark_ru:this.storeLandmark_ru,storeLandmark_uz:this.storeLandmark_uz,storeDescription_ru:this.descriptionText_ru,storeDescription_uz:this.descriptionText_uz,storeName:this.name,category_id:this.categoryID,storeOwner:this.storeOwnerID},t=N(),d=Object.assign(c,t);var e=new FormData;e.append("productIMG",this.banner_ru);for(const o in d)e.append(o,d[o]);try{let o=localStorage.getItem("token");const n=await fetch(this.url+"api/v1/store/edit/"+this.$route.params.id,{method:"POST",body:e,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+o}}),h=await n.json();window.scrollTo({top:0,behavior:"smooth"}),n.status==401?(this.resStringError=h.message,this.added=!1):h.error?(typeof h.message=="object"?this.resError=h.message:this.resStringError=h.message,this.added=!1):this.resSuccess="Store Successfully Updated"}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",o)}},uploadFilebannerRu(c){var t=c.target.files||c.dataTransfer.files;if(!t.length){this.banner_ru=[],this.banner_ru_prev="";return}this.banner_ru=t[0],this.banner_ru_prev=URL.createObjectURL(t[0])},getAddressByCoor(c,t){this.lat=c,this.long=t;let d=this.url+"api/v1/getAdressByCoor?lat="+c+"&long="+t,e=localStorage.getItem("token");const o={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e})};fetch(d,o).then(n=>(n.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),n.json())).then(n=>{this.storeLandmark_ru="",this.storeLandmark_uz="",n.street||n.house?(n.street&&(this.storeLandmark_ru+=n.street,this.storeLandmark_uz+=n.street),n.house&&(this.storeLandmark_ru+=" "+n.house,this.storeLandmark_uz+=" "+n.house)):(n.other&&(this.storeLandmark_ru+=" "+n.other,this.storeLandmark_uz+=" "+n.other),n.area&&(this.storeLandmark_ru+=" "+n.area,this.storeLandmark_uz+=" "+n.area))})},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},requestGetcategories(){let c=this.url+"api/v1/store/category?page=1",t=localStorage.getItem("token");const d={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(c,d).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.categories=e.data})},requestGetStoreOwners(){let c=this.url+"api/v1/store/storeOwner",t=localStorage.getItem("token");const d={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(c,d).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.storeOwners=e.data})},async getStoreAbout(){let c=this.url+"api/v1/store?store_id="+this.$route.params.id,t=localStorage.getItem("token");const d={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t})};fetch(c,d).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{var o,n,h,r;e&&(this.name=e.storeName,this.lat=e.storeLatitude,this.long=e.storeLongitude,this.storeOwnerID=e.storeOwner,this.categoryID=e.category_id,this.descriptionText_ru=(o=JSON.parse(e.storeDescription))==null?void 0:o.ru,this.descriptionText_uz=(n=JSON.parse(e.storeDescription))==null?void 0:n.uz,this.storeLandmark_ru=(h=JSON.parse(e.storeLandmark))==null?void 0:h.ru,this.storeLandmark_uz=(r=JSON.parse(e.storeLandmark))==null?void 0:r.uz)})}},created(){this.requestGetcategories(),this.requestGetStoreOwners(),ymaps.ready(c=>{var t=new ymaps.Map("map",{center:[41.311081,69.240562],zoom:11},{searchControlProvider:"yandex#search"});console.log(this.lat),t.events.add("click",d=>{if(t.balloon.isOpen())t.balloon.close();else{var e=d.get("coords");t.balloon.open(e,{contentBody:"<p>Coordinates: "+[e[0].toPrecision(6),e[1].toPrecision(6)].join(", ")+"</p>",contentFooter:"<sup>Click again</sup>"}),this.getAddressByCoor(e[0],e[1])}})}),this.getStoreAbout()}},_=c=>(B("data-v-c441eb4b"),c=c(),E(),c),C={class:"mt-3"},V={class:"row"},$={class:"col-md-12 grid-margin stretch-card"},q={class:"card"},G={class:"card-body"},M=_(()=>s("h4",{class:"card-title"},"Update Store",-1)),R={class:"error"},P={key:1,class:"error"},F={key:2,class:"success"},J={class:"form-group row"},H={class:"col-md-6"},K=_(()=>s("label",{for:"banner"},"Category",-1)),Q=_(()=>s("option",{disabled:"",value:"0"},"Please select one",-1)),W=["value"],X={class:"col-md-6"},Y=_(()=>s("label",{for:"banner"},"Store Owner",-1)),Z=_(()=>s("option",{disabled:"",value:"0"},"Please select one",-1)),ee=["value"],re={class:"col-md-12"},te=_(()=>s("label",{for:"exampleInputNameRu"},"Name",-1)),oe={class:"col-md-6"},se=_(()=>s("label",{for:"exampleInputDescriptionRu"},"Description Ru",-1)),ne={class:"col-md-6"},ae=_(()=>s("label",{for:"exampleInputDescriptionUz"},"Description Uz",-1)),ie={class:"col-md-12 mt-4"},le={class:"col-md-6"},ce=_(()=>s("label",{for:"exampleInputLandMark"},"Street, house Ru",-1)),de={class:"col-md-6"},ue=_(()=>s("label",{for:"exampleInputLandMarkUz"},"Street, house Uz",-1)),me=["disabled"];function pe(c,t,d,e,o,n){const h=O("GoBackButton");return a(),i(m,null,[U(h),s("div",C,[s("div",V,[s("div",$,[s("div",q,[s("div",G,[M,o.resError?(a(!0),i(m,{key:0},p(o.resError,(r,l)=>(a(),i("p",R,u(l)+" : "+u(r[0]),1))),256)):y("",!0),o.resStringError?(a(),i("p",P,u(o.resStringError),1)):y("",!0),o.resSuccess?(a(),i("p",F,u(o.resSuccess),1)):y("",!0),s("form",{class:"forms-sample",onSubmit:t[7]||(t[7]=j(r=>n.submitForm(),["prevent"]))},[s("div",J,[s("div",H,[K,k(s("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>o.categoryID=r),class:v(["form-control",{"border border-danger":e.v$.categoryID.$errors.length>0}])},[Q,(a(!0),i(m,null,p(o.categories,r=>(a(),i("option",{key:r.id,value:r.id},u(JSON.parse(r.name).ru),9,W))),128))],2),[[w,o.categoryID]]),(a(!0),i(m,null,p(e.v$.categoryID.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))]),s("div",X,[Y,k(s("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>o.storeOwnerID=r),class:v(["form-control",{"border border-danger":e.v$.storeOwnerID.$errors.length>0}])},[Z,(a(!0),i(m,null,p(o.storeOwners,r=>{var l;return a(),i("option",{key:r.id,value:(l=r.phonebook)==null?void 0:l.user_id},u(r.firstName+" "+r.lastName),9,ee)}),128))],2),[[w,o.storeOwnerID]]),(a(!0),i(m,null,p(e.v$.storeOwnerID.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))]),s("div",re,[te,k(s("input",{type:"text",class:v(["form-control",{"border border-danger":e.v$.name.$errors.length>0}]),placeholder:"Store Name",id:"exampleInputNameRu","onUpdate:modelValue":t[2]||(t[2]=r=>o.name=r)},null,2),[[f,o.name]]),(a(!0),i(m,null,p(e.v$.name.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))]),s("div",oe,[se,k(s("textarea",{rows:"10",type:"text",class:v(["form-control",{"border border-danger":e.v$.descriptionText_ru.$errors.length>0}]),id:"exampleInputDescriptionRu","onUpdate:modelValue":t[3]||(t[3]=r=>o.descriptionText_ru=r)},null,2),[[f,o.descriptionText_ru]]),(a(!0),i(m,null,p(e.v$.descriptionText_ru.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))]),s("div",ne,[ae,k(s("textarea",{rows:"10",type:"text",class:v(["form-control",{"border border-danger":e.v$.descriptionText_uz.$errors.length>0}]),id:"exampleInputDescriptionUz","onUpdate:modelValue":t[4]||(t[4]=r=>o.descriptionText_uz=r)},null,2),[[f,o.descriptionText_uz]]),(a(!0),i(m,null,p(e.v$.descriptionText_uz.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))]),s("div",ie,[s("div",{id:"map",style:{"min-width":"95%",height:"400px",overflow:"hidden"},class:v({"border border-danger":e.v$.lat.$errors.length>0})},null,2),(a(!0),i(m,null,p(e.v$.lat.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},"Select Address in Map"))),128))]),s("div",le,[ce,k(s("input",{type:"text",class:v(["form-control",{"border border-danger":e.v$.storeLandmark_ru.$errors.length>0}]),placeholder:"Street, house",id:"exampleInputLandMark","onUpdate:modelValue":t[5]||(t[5]=r=>o.storeLandmark_ru=r)},null,2),[[f,o.storeLandmark_ru]]),(a(!0),i(m,null,p(e.v$.storeLandmark_ru.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))]),s("div",de,[ue,k(s("input",{type:"text",class:v(["form-control",{"border border-danger":e.v$.storeLandmark_uz.$errors.length>0}]),placeholder:"Street, house",id:"exampleInputLandMarkUz","onUpdate:modelValue":t[6]||(t[6]=r=>o.storeLandmark_uz=r)},null,2),[[f,o.storeLandmark_uz]]),(a(!0),i(m,null,p(e.v$.storeLandmark_uz.$errors,(r,l)=>(a(),i("small",{class:"error",key:l},u(r.$message),1))),128))])]),o.added?y("",!0):(a(),i("button",{key:0,type:"submit",disabled:n.isDisabled,class:"btn btn-primary mr-2"},"Update",8,me))],32)])])])])])],64)}const ye=x(A,[["render",pe],["__scopeId","data-v-c441eb4b"]]);export{ye as default};
