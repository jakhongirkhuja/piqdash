import{C as y,P as b}from"./Pagination.b8ff8fbc.js";import{L as w}from"./LanguageSwitcher.c9c9f8e9.js";import{s as C}from"./globalFunction.5ce06618.js";import{_ as k,r as g,o as a,c,a as e,b as _,d as u,w as P,v as N,f as q,F as m,e as f,t as i,g as A,a2 as x,a3 as B,h as D}from"./index.34e73fda.js";const T={data(){return{imageUrl:"https://api.pharmiq.uz/files/course/",disabled:!1,modelName:"",modelUserId:"",currentPage:1,last_page:1,total:1,per_page:1,courses:[],response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,courseSearch:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:y,Pagination:b,LanguageSwitcher:w},computed:{},methods:{checkStatus(s,l){let n=new Date(s);return l&&new Date>l?"Arxived":n>new Date?(console.log(n,new Date),"upgoing"):(n<=new Date,"ongoing")},countQuizIqc(s){let l=0;return s.forEach(n=>{n.quizes&&(l+=n.quizes.prizeIQC)}),l},showImageUrl(s){return this.imageUrl+s},searchcourse(){clearTimeout(this.timerId),this.courseSearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.courseSearch)},2e3)):(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showcourse(s){this.$router.push({name:"courses.show",params:{id:s}})},openmodel(s,l){this.modelUserId=s,this.modelName=l,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editcourse(s){this.$router.push({name:"courses.edit",params:{id:s}})},onPageChange(s){console.log(s),this.currentPage=s,this.loading=!0,this.requestApi(s),localStorage.setItem("currentPage",s)},refreshList(){this.loading=!0,this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const s={usid:this.modelUserId},l=C(),n=Object.assign(s,l);try{let h=localStorage.getItem("token");console.log(this.modelUserId);const r=await(await fetch(this.url+"api/v1/course/delete/"+this.modelUserId,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+h}})).json();r.error?typeof r.message=="object"?this.resError=r.message:this.resStringError=r.message:(this.resSuccess="Successfully Deleted",this.requestApi(1),this.submitButton=!1)}catch(h){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",h)}},requestApi(s,l=null){let n=this.url+"api/v1/course?page="+s;l&&(n=this.url+"api/v1/course?page=1&search="+l);let h=localStorage.getItem("token");const o={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+h})};fetch(n,o).then(r=>(r.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),r.json())).then(r=>{this.response=r,this.last_page=r.last_page,this.total=r.total,this.per_page=r.per_page,this.courses=r.data,console.log(this.courses),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},mounted(){this.$i18n.locale="ru",console.log(this.$i18n.availableLocales)},created(){this.userInfo=JSON.parse(localStorage.getItem("user"));const s=localStorage.getItem("currentPage");s&&(this.currentPage=parseInt(s)),this.requestApi(1)}},d=s=>(x("data-v-337f0588"),s=s(),B(),s),z={class:"row"},E={class:"col-md-3"},U={class:"col-md-6"},O={class:"col-md-3 text-center"},L={class:"mt-3"},j={class:"row"},M={class:"col-12"},J={class:"table-responsive"},Q={class:"table"},V=d(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Banner"),e("th",{scope:"col",style:{width:"120px",overflow:"hidden"}},"Title"),e("th",{scope:"col"},"Monetized"),e("th",{scope:"col"},"Price"),e("th",{scope:"col"},"Prize"),e("th",{scope:"col"},"Users got"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Start Date"),e("th",{scope:"col"},"Actions")])],-1)),F=["src"],G={style:{width:"120px",overflow:"hidden"}},H={class:"actions"},R=["onClick"],Y=d(()=>e("i",{class:"ti ti-eye","data-toggle":"tooltip",title:"Show"},null,-1)),K=[Y],W=["onClick"],X=d(()=>e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1)),Z=[X],ee=["onClick"],te=d(()=>e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Edit"},null,-1)),se=[te],oe={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},re={class:"modal-dialog",role:"document"},le={class:"modal-content"},ie=d(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete Course"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1)),ae={class:"modal-body text-center"},ne={class:"error"},ce={key:1,class:"error"},ue={key:2,class:"success"},de=d(()=>e("h4",null,"Are you sure you want to delete this Course?",-1)),he={class:"modal-footer"},pe=d(()=>e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1)),me=["disabled"],ge={key:0,class:"loading"},_e=d(()=>e("img",{src:D},null,-1)),fe=[_e];function Se(s,l,n,h,o,r){const S=g("CrudButton"),I=g("LanguageSwitcher"),v=g("Pagination");return a(),c(m,null,[e("div",z,[e("div",E,[o.userInfo&&(o.userInfo.role=="Creator"||o.userInfo.role=="Owner")?(a(),_(S,{key:0,urlName:"courses.add",btnName:"Add Course"})):u("",!0)]),e("div",U,[P(e("input",{type:"search",onInput:l[0]||(l[0]=(...t)=>r.searchcourse&&r.searchcourse(...t)),"onUpdate:modelValue":l[1]||(l[1]=t=>o.courseSearch=t),class:"form-control",placeholder:"Search"},null,544),[[N,o.courseSearch]])]),e("div",O,[q(I)])]),e("div",L,[e("div",j,[e("div",M,[e("div",J,[e("table",Q,[V,e("tbody",null,[(a(!0),c(m,null,f(o.courses,t=>(a(),c("tr",{key:t.id},[t.infos?(a(),c(m,{key:0},[e("td",null,[e("img",{src:r.showImageUrl(s.$i18n.locale=="ru"?JSON.parse(t.infos.courseBanner).ru:JSON.parse(t.infos.courseBanner).uz),alt:""},null,8,F),A(" ( "+i(t.totalpass==null?0:t.totalpass)+" ) ",1)]),e("td",G,i(s.$i18n.locale=="ru"?JSON.parse(t.infos.courseTitleName).ru:JSON.parse(t.infos.courseTitleName).uz),1),e("td",null,i(t.courseMonetized?"Yes":"No"),1),e("td",null,i(t.coursePrice==0||!t.coursePrice?"Free":t.coursePrice),1),e("td",null,i(r.countQuizIqc(t.lessons))+" IQC",1),e("td",null,i(t.usergot)+" IQC",1),e("td",null,i(t.courseTypeByAccess==1?"For All":"Special")+" / "+i(t.access?"Private":"Public"),1),e("td",null,i(r.checkStatus(t.startDate,t.endDate)),1),e("td",null,i(t.startDate),1),e("td",H,[e("div",{onClick:p=>r.showcourse(t.id),class:"show text-primary mr-2 cursor-pointer"},K,8,R),o.userInfo&&(o.userInfo.role=="Creator"||o.userInfo.role=="Owner")?(a(),c("div",{key:0,onClick:p=>r.editcourse(t.id),class:"edit mr-2 cursor-pointer"},Z,8,W)):u("",!0),o.userInfo&&(o.userInfo.role=="Creator"||o.userInfo.role=="Owner")?(a(),c("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:p=>r.openmodel(t.id,JSON.parse(t.infos.courseTitleName).ru),class:"delete text-danger"},se,8,ee)):u("",!0)])],64)):u("",!0)]))),128))])])]),o.last_page!=1?(a(),_(v,{key:0,"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":o.currentPage,onPagechanged:r.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])):u("",!0)])])]),e("div",oe,[e("div",re,[e("div",le,[ie,e("div",ae,[o.resError?(a(!0),c(m,{key:0},f(o.resError,(t,p)=>(a(),c("p",ne,i(p)+" : "+i(t[0]),1))),256)):u("",!0),o.resStringError?(a(),c("p",ce,i(o.resStringError),1)):u("",!0),o.resSuccess?(a(),c("p",ue,i(o.resSuccess),1)):u("",!0),de,e("h4",null,i(o.modelName),1),e("p",null,"courseId: "+i(o.modelUserId),1)]),e("div",he,[pe,o.submitButton?(a(),c("button",{key:0,disabled:o.disabled,type:"button",onClick:l[2]||(l[2]=(...t)=>r.requestApiDelete&&r.requestApiDelete(...t)),class:"btn btn-primary"},"Delete Course",8,me)):u("",!0)])])])]),o.loading?(a(),c("div",ge,fe)):u("",!0)],64)}const we=k(T,[["render",Se],["__scopeId","data-v-337f0588"]]);export{we as default};
