import{G as V}from"./GoBackButton.8ec57f12.js";import{c as j}from"./vue-datepicker.es.17b3f44e.js";import{h as U}from"./maska.esm.cd315c5a.js";import{u as x,r as y,m as E,a as I,e as F}from"./index.esm.b21b73c4.js";import{_ as T,j as O,r as w,k as A,o,c as n,f as D,a as t,F as d,e as g,d as u,t as c,l as N,w as f,v,n as S,a0 as B,m as k,p as q,g as L,a1 as z,a2 as P,a3 as G}from"./index.34e73fda.js";import{s as M}from"./globalFunction.5ce06618.js";const J={setup(){const l=O(new Date),r=a=>{const e=a.getDate(),i=a.getMonth()+1,b=a.getFullYear();return`${e}/${i}/${b}`},p=a=>{l.value=a};return{v$:x(),format:r,setDate:p}},directives:{maska:U},components:{GoBackButton:V,Datepicker:j},data(){return{url:"https://api.pharmiq.uz/",firstName:"",lastName:"",date:"",birthDate:"",gender:0,companySearch2:"",companySearch2Merge:"",isDisabledMerge:!1,language:"ru",email:"",role:"SuperAdmin",phoneNumber:"",password:"",confirmPassword:"",resError:!1,resSuccess:!1,resStringError:"",numberconfirm:!1,userInfo:null,company:null,loading:!1,response:null,responseMerge:null,resStringErrorChange:"",resStringErrorChangeMerge:"",resErrorChange:"",resErrorChangeMerge:"",resSuccessChange:"",resSuccessChangeMerge:"",comapnyId:null}},computed:{checkGender(){return this.gender==0},isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0},numberconfirmcheck:function(){return console.log(this.numberconfirm),this.numberconfirm==1}},validations(){return{firstName:{required:y,minLengthValue:E(1),maxLengthValue:I(30)},lastName:{required:y,minLengthValue:E(3),maxLengthValue:I(30)},phoneNumber:{required:y},birthDate:{required:y},gender:{required:y},role:{required:y},language:{required:y},birthDate:{required:y},email:{email:F}}},methods:{check:function(l){l.target.checked?this.numberconfirm=1:this.numberconfirm=0},changeSearchVariableMerge(l,r){this.companySearch2Merge=r,this.responseMerge=null,this.comapnyId=l},changeSearchVariable(l,r){this.companySearch2=r,this.response=null,this.comapnyId=l},async submitFormUpdateCompanyMerge(){if(this.isDisabledMerge=!0,!this.comapnyId)return;const l={user_id:this.$route.params.id,company_id:this.comapnyId};let r=M();const p=Object.assign(l,r);try{let a=localStorage.getItem("token");const e=await fetch(this.url+"api/v1/admin/mergeUserCompany",{method:"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+a}}),i=await e.json();e.status==401?this.resStringErrorChangeMerge=i.message:i.error?(setTimeout(()=>{this.isDisabledMerge=!1},1e3),typeof i.message=="object"?this.resErrorChangeMerge=i.message:this.resStringErrorChangeMerge=i.message):this.resSuccessChangeMerge="Successfully Merged"}catch(a){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",a)}},async submitFormUpdateCompany(){if(!this.comapnyId)return;const l={user_id:this.$route.params.id,company_id:this.comapnyId};let r=M();const p=Object.assign(l,r);try{let a=localStorage.getItem("token");const e=await fetch(this.url+"api/v1/admin/updateUserCompany",{method:"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+a}}),i=await e.json();e.status==401?this.resStringErrorChange=i.message:i.error?typeof i.message=="object"?this.resErrorChange=i.message:this.resStringErrorChange=i.message:this.resSuccessChange="Successfully updated"}catch(a){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",a)}},searchCompanyMerge(){this.resStringErrorChangeMerge="",clearTimeout(this.timerId),this.companySearch2Merge!=""&&(this.timerId=setTimeout(()=>this.requestApiSearchMerge(1,this.companySearch2Merge),3e3))},searchCompany(){this.resStringErrorChange="",clearTimeout(this.timerId),this.companySearch2!=""&&(this.loading=!0,this.timerId=setTimeout(()=>this.requestApiSearch(1,this.companySearch2),3e3))},requestApiSearchMerge(l,r=null){this.currentPage=l;let p=this.url+"api/v1/company/show/all?page="+l;r&&(p=this.url+"api/v1/company/show/all?page=1&search="+r);let a=localStorage.getItem("token");fetch(p,{method:"GET",headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+a}}).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.responseMerge=e.companies.data,console.log(this.responseMerge),this.responseMerge.length==0&&(this.resStringErrorChangeMerge="Company Name not found, please try another name"),setTimeout(()=>{},1e3)})},requestApiSearch(l,r=null){this.currentPage=l;let p=this.url+"api/v1/company/show/all?page="+l;r&&(p=this.url+"api/v1/company/show/all?page=1&search="+r);let a=localStorage.getItem("token");fetch(p,{method:"GET",headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+a}}).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.response=e.companies.data,console.log(this.response),this.response.length==0&&(this.resStringErrorChange="Company Name not found, please try another name"),setTimeout(()=>{this.loading=!1},1e3)})},changeFormat(){const l=this.phoneNumber.replace(/\D/g,"");this.phoneNumber="+"+l.substring(0,3)+" ( "+l.substring(3,5)+" ) "+l.substring(5,8)+"-"+l.substring(8,10)+"-"+l.substring(10,12)},trimFirstNameFunction(){this.firstName=this.firstName.trim()},trimLastNameFunction(){this.lastName=this.lastName.trim()},requestApi(l){fetch(this.url+"api/v1/admin/show/users/"+l).then(r=>r.json()).then(r=>{r&&(this.company=r.company,r=r.user,this.firstName=r.firstName,this.lastName=r.lastName,this.birthDate=r.birthDate,this.gender=r.gender,r.phonebook&&(this.phoneNumber="+"+r.phonebook.phoneNumber.substring(0,3)+" ( "+r.phonebook.phoneNumber.substring(3,5)+" ) "+r.phonebook.phoneNumber.substring(5,8)+"-"+r.phonebook.phoneNumber.substring(8,10)+"-"+r.phonebook.phoneNumber.substring(10,12),this.numberconfirm=r.phonebook.status),this.role=r.role,this.language=r.language,this.email=r.email?r.email.email:"")})},async requestApiEdit(){const l=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"});let r=new Date(this.birthDate);const p=l.format(r);console.log(this.numberconfirm);const a={user_id:this.$route.params.id,firstName:this.firstName,lastName:this.lastName,language:this.language,gender:this.gender,birthDate:p.split("/").reverse().join("-"),role:this.role,email:this.email,numberconfirm:this.numberconfirm,number:this.phoneNumber.replace(/\D/g,"")},e=M(),i=Object.assign(a,e);try{let b=localStorage.getItem("token");const C=await fetch(this.url+"api/v1/admin/update/users",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+b}}),_=await C.json();window.scrollTo({top:0,behavior:"smooth"}),C.status==401?this.resStringError=_.message:_.error?typeof _.message=="object"?this.resError=_.message:this.resStringError=_.message:this.resSuccess="Successfully updated"}catch(b){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",b)}},submitForm(){if(this.v$.$touch(),!this.v$.$error)if(this.userInfo.role=="Creator")this.requestApiEdit();else return}},created(){this.userInfo=JSON.parse(localStorage.getItem("user")),this.requestApi(this.$route.params.id),console.log(this.userInfo)}},h=l=>(P("data-v-595c79d9"),l=l(),G(),l),R={class:"mt-3"},Y={class:"row"},H={class:"col-md-12 grid-margin stretch-card"},K={class:"card"},Q={class:"card-body"},W=h(()=>t("h4",{class:"card-title"},"Edit User",-1)),X=h(()=>t("p",{class:"card-description"}," Basic information ",-1)),Z={class:"error"},$={key:1,class:"error"},ee={key:2,class:"success"},re={class:"form-group row"},se={class:"col-md-6"},te=h(()=>t("label",{for:"exampleInputUsername1"},"Enter first name",-1)),oe={class:"col-md-6"},ne=h(()=>t("label",{for:"exampleInputLastName"},"Enter last name",-1)),ie={class:"form-group row"},ae={class:"col-md-6"},le=h(()=>t("label",{for:"exampleInputBirth"},"Date of Birth",-1)),ce={class:"col-md-6"},me=h(()=>t("label",{for:"phonebook"},"Phone Number",-1)),ue=h(()=>t("label",{for:"numberconfirm"},"Confirmed number",-1)),he={class:"form-group row"},pe={class:"col-md-12"},de=h(()=>t("label",{class:"col-sm-3 col-form-label"},"Choose gender",-1)),ge={class:"col-sm-4"},fe=h(()=>t("label",{for:"gender1"},"Male",-1)),be={class:"col-sm-5"},ye=h(()=>t("label",{for:"gender2"},"Female",-1)),_e={class:"form-group"},ve=h(()=>t("label",{for:"exampleFormControlSelect1"},"Choose role",-1)),Se=["disabled"],Ce=z('<option value="SuperAdmin" data-v-595c79d9>SuperAdmin</option><option value="Scout" data-v-595c79d9>Scout</option><option value="Creator" data-v-595c79d9>Creator</option><option value="Owner" data-v-595c79d9>Owner</option><option value="Analytic" data-v-595c79d9>Analytic</option><option value="Tester" data-v-595c79d9>Tester</option>',6),ke={key:0,value:"Store Owner"},Ne=h(()=>t("option",{value:"Employee",disabled:""},"Employee",-1)),Me=h(()=>t("option",{value:"Company Owner",disabled:""},"Company Owner",-1)),Ee={class:"form-group"},Ie=h(()=>t("label",{for:"test1"},"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",-1)),we=h(()=>t("label",{for:"test2"},"O'zbekcha",-1)),De={class:"form-group"},Ve=h(()=>t("label",{for:"exampleInputEmail1"},"Email address",-1)),je=["disabled"],Ue={key:0,class:"col-md-12 grid-margin stretch-card"},xe={key:0,class:"card"},Fe={class:"card-body"},Te=h(()=>t("h4",{class:"card-title"},"Merge into Company ",-1)),Oe={class:"error"},Ae={key:1,class:"error"},Be={key:2,class:"success"},qe={key:0,class:"results"},Le=["onClick"],ze=["disabled"],Pe={key:1,class:"col-md-12 grid-margin stretch-card"},Ge={class:"card"},Je={class:"card-body"},Re=h(()=>t("h4",{class:"card-title"},"Change Company Member ",-1)),Ye={key:0,class:"card-description"},He={key:0},Ke={class:"error"},Qe={key:2,class:"error"},We={key:3,class:"success"},Xe={key:0,class:"results"},Ze=["onClick"],$e=["disabled"];function er(l,r,p,a,e,i){const b=w("GoBackButton"),C=w("Datepicker"),_=A("maska");return o(),n(d,null,[D(b),t("div",R,[t("div",Y,[t("div",H,[t("div",K,[t("div",Q,[W,X,e.resError?(o(!0),n(d,{key:0},g(e.resError,(s,m)=>(o(),n("p",Z,c(m)+" : "+c(s[0]),1))),256)):u("",!0),e.resStringError?(o(),n("p",$,c(e.resStringError),1)):u("",!0),e.resSuccess?(o(),n("p",ee,c(e.resSuccess),1)):u("",!0),t("form",{class:"forms-sample",onSubmit:r[14]||(r[14]=N(s=>i.submitForm(),["prevent"]))},[t("div",re,[t("div",se,[te,f(t("input",{type:"text",class:S(["form-control",{"border border-danger":a.v$.firstName.$errors.length>0}]),onInput:r[0]||(r[0]=(...s)=>i.trimFirstNameFunction&&i.trimFirstNameFunction(...s)),"onUpdate:modelValue":r[1]||(r[1]=s=>e.firstName=s),id:"exampleInputUsername1",placeholder:"First name"},null,34),[[v,e.firstName]]),(o(!0),n(d,null,g(a.v$.firstName.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128))]),t("div",oe,[ne,f(t("input",{type:"text",class:S(["form-control",{"border border-danger":a.v$.firstName.$errors.length>0}]),onInput:r[2]||(r[2]=(...s)=>i.trimLastNameFunction&&i.trimLastNameFunction(...s)),"onUpdate:modelValue":r[3]||(r[3]=s=>e.lastName=s),id:"exampleInputLastName",placeholder:"Last name"},null,34),[[v,e.lastName]]),(o(!0),n(d,null,g(a.v$.lastName.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128))])]),t("div",ie,[t("div",ae,[le,D(C,{modelValue:e.birthDate,"onUpdate:modelValue":r[4]||(r[4]=s=>e.birthDate=s),inputClassName:"form-control",format:a.format},null,8,["modelValue","format"]),(o(!0),n(d,null,g(a.v$.birthDate.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128))]),t("div",ce,[me,f(t("input",{type:"text",placeholder:"+998 ( 99 ) 999-99-99",class:S(["form-control",{"border border-danger":a.v$.phoneNumber.$errors.length>0}]),"onUpdate:modelValue":r[5]||(r[5]=s=>e.phoneNumber=s)},null,2),[[_,["+998 ( ## ) ###-##-##","+998 ( ## ) ###-##-##"]],[v,e.phoneNumber]]),(o(!0),n(d,null,g(a.v$.phoneNumber.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128)),f(t("input",{type:"checkbox",onChange:r[6]||(r[6]=s=>i.check(s)),style:{position:"relative",top:"20px",display:"block"},id:"numberconfirm",name:"radio-confirm ","onUpdate:modelValue":r[7]||(r[7]=s=>i.numberconfirmcheck=s)},null,544),[[B,i.numberconfirmcheck]]),ue])]),t("div",he,[t("div",pe,[de,(o(!0),n(d,null,g(a.v$.gender.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128))]),t("div",ge,[f(t("input",{type:"radio",id:"gender1",name:"radio-gender",value:0,"onUpdate:modelValue":r[8]||(r[8]=s=>e.gender=s)},null,512),[[k,e.gender]]),fe]),t("div",be,[f(t("input",{type:"radio",id:"gender2",name:"radio-gender",value:1,"onUpdate:modelValue":r[9]||(r[9]=s=>e.gender=s)},null,512),[[k,e.gender]]),ye])]),t("div",_e,[ve,f(t("select",{disabled:e.role=="Employee"||e.role=="Company Owner"||e.role=="Owner"||e.role=="Analytic",class:S(["form-control",{"border border-danger":a.v$.role.$errors.length>0}]),"onUpdate:modelValue":r[10]||(r[10]=s=>e.role=s),id:"exampleFormControlSelect1"},[Ce,e.userInfo&&(e.userInfo.role=="Creator"||e.userInfo.role=="Owner")?(o(),n("option",ke,"Store Owner")):u("",!0),Ne,Me],10,Se),[[q,e.role]]),(o(!0),n(d,null,g(a.v$.role.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128))]),t("div",Ee,[t("p",null,[f(t("input",{checked:"",type:"radio",id:"test1",name:"radio-language",value:"ru","onUpdate:modelValue":r[11]||(r[11]=s=>e.language=s)},null,512),[[k,e.language]]),Ie]),t("p",null,[f(t("input",{type:"radio",id:"test2",name:"radio-language",value:"uz","onUpdate:modelValue":r[12]||(r[12]=s=>e.language=s)},null,512),[[k,e.language]]),we])]),t("div",De,[Ve,f(t("input",{type:"email",class:S(["form-control",{"border border-danger":a.v$.email.$errors.length>0}]),id:"exampleInputEmail1","onUpdate:modelValue":r[13]||(r[13]=s=>e.email=s),placeholder:"Email"},null,2),[[v,e.email]]),(o(!0),n(d,null,g(a.v$.email.$errors,(s,m)=>(o(),n("small",{class:"error",key:m},c(s.$message),1))),128))]),e.userInfo.role=="Creator"?(o(),n("button",{key:0,type:"submit",disabled:i.isDisabled,class:"btn btn-primary mr-2"},"Update",8,je)):u("",!0)],32)])])]),e.role=="Company Owner"?(o(),n("div",Ue,[e.userInfo.role=="Owner"||e.userInfo.role=="Creator"?(o(),n("div",xe,[t("div",Fe,[Te,e.resErrorChangeMerge?(o(!0),n(d,{key:0},g(e.resErrorChangeMerge,(s,m)=>(o(),n("p",Oe,c(m)+" : "+c(s[0]),1))),256)):u("",!0),e.resStringErrorChangeMerge?(o(),n("p",Ae,c(e.resStringErrorChangeMerge),1)):u("",!0),e.resSuccessChangeMerge?(o(),n("p",Be,c(e.resSuccessChangeMerge),1)):u("",!0),t("form",{class:"forms-sample",onSubmit:r[17]||(r[17]=N(s=>i.submitFormUpdateCompanyMerge(),["prevent"]))},[f(t("input",{type:"search",onInput:r[15]||(r[15]=(...s)=>i.searchCompanyMerge&&i.searchCompanyMerge(...s)),"onUpdate:modelValue":r[16]||(r[16]=s=>e.companySearch2Merge=s),class:"form-control",placeholder:"Search: PharmIq"},null,544),[[v,e.companySearch2Merge]]),e.responseMerge&&e.responseMerge.length>0?(o(),n("div",qe,[(o(!0),n(d,null,g(e.responseMerge,s=>(o(),n("div",{class:"results__each",key:s.id,onClick:m=>i.changeSearchVariableMerge(s.id,s.companyName)},c(s.companyName),9,Le))),128))])):u("",!0),t("button",{type:"submit",disabled:e.isDisabledMerge,class:"btn btn-primary mt-2"},"Merge",8,ze)],32)])])):u("",!0)])):u("",!0),e.role=="Employee"?(o(),n("div",Pe,[t("div",Ge,[t("div",Je,[Re,e.company?(o(),n("p",Ye,[L(" Membership: "+c(e.company.companyName)+" ",1),e.loading?(o(),n("span",He,"| loading...")):u("",!0)])):u("",!0),e.resErrorChange?(o(!0),n(d,{key:1},g(e.resErrorChange,(s,m)=>(o(),n("p",Ke,c(m)+" : "+c(s[0]),1))),256)):u("",!0),e.resStringErrorChange?(o(),n("p",Qe,c(e.resStringErrorChange),1)):u("",!0),e.resSuccessChange?(o(),n("p",We,c(e.resSuccessChange),1)):u("",!0),t("form",{class:"forms-sample",onSubmit:r[20]||(r[20]=N(s=>i.submitFormUpdateCompany(),["prevent"]))},[f(t("input",{type:"search",onInput:r[18]||(r[18]=(...s)=>i.searchCompany&&i.searchCompany(...s)),"onUpdate:modelValue":r[19]||(r[19]=s=>e.companySearch2=s),class:"form-control",placeholder:"Search: PharmIq"},null,544),[[v,e.companySearch2]]),e.response&&e.response.length>0?(o(),n("div",Xe,[(o(!0),n(d,null,g(e.response,s=>(o(),n("div",{class:"results__each",key:s.id,onClick:m=>i.changeSearchVariable(s.id,s.companyName)},c(s.companyName),9,Ze))),128))])):u("",!0),t("button",{type:"submit",disabled:i.isDisabled,class:"btn btn-primary mt-2"},"Change",8,$e)],32)])])])):u("",!0)])])],64)}const ar=T(J,[["render",er],["__scopeId","data-v-595c79d9"]]);export{ar as default};
