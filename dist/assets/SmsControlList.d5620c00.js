import{C as I,P as S}from"./Pagination.b8ff8fbc.js";import{L as x}from"./LanguageSwitcher.c9c9f8e9.js";import{s as C}from"./globalFunction.5ce06618.js";import{_ as w,r as g,o as i,c as n,a as e,b as _,d as a,t as c,w as M,v as P,n as f,F as p,e as b,g as k,a2 as T,a3 as A,h as B}from"./index.34e73fda.js";const D={data(){return{imageUrl:"https://api.pharmiq.uz/files/inboxMessage/",disabled:!1,load:!1,modelName:"",errorInput:!1,checkModel:null,modelUserId:"",currentPage:1,totalClick:null,last_page:1,total:1,per_page:1,inboxes:[],response:null,errorMessage:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,inboxesearch:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:I,Pagination:S,LanguageSwitcher:x},computed:{},methods:{checkStatus(s){let l=new Date(s);return l>new Date?"upgoing":l<new Date?"Deactived":"ongoing"},showImageUrl(s){return this.imageUrl+s},searchinbox(){clearTimeout(this.timerId),this.inboxesearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.inboxesearch)},2e3)):(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showinbox(s){},openmodel(s,l){this.modelUserId=s,this.modelName=l,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editinbox(s){this.$router.push({name:"sms.edit",params:{id:s}})},onPageChange(s){console.log(s),this.currentPage=s,this.loading=!0,this.requestApi(s),localStorage.setItem("currentPage",s)},refreshList(){this.loading=!0,this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const s={usid:this.modelUserId},l=C(),u=Object.assign(s,l);try{let d=localStorage.getItem("token");console.log(this.modelUserId);const o=await(await fetch(this.url+"api/v1/inbox/delete/"+this.modelUserId,{method:"POST",body:JSON.stringify(u),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+d}})).json();o.error?typeof o.message=="object"?this.resError=o.message:this.resStringError=o.message:(this.resSuccess="Successfully Deleted",this.requestApi(1),this.submitButton=!1)}catch(d){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",d)}},requestApi(s,l=null){let u=this.url+"api/v1/inbox?sms=ok&page="+s,d=localStorage.getItem("token");const t={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+d})};fetch(u,t).then(o=>(o.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{this.response=o,this.last_page=o.last_page,this.total=o.total,this.per_page=o.per_page,this.inboxes=o.data,console.log(o.data),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})},async checkLink(){var s=this.checkModel;if(s.indexOf("https://")!=0){this.errorInput=!0,this.errorMessage="link does not contain https://";return}else this.errorInput=!1,this.errorMessage=null;this.load=!0,this.totalClick=null;try{const l=await fetch("https://api-ssl.bitly.com/v4/bitlinks/"+s.replace("https://","")+"/clicks/summary",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer c901f75cdbf7109305be80438d5cfc005d12925b"}}),u=await l.json(),d=l.status;this.load=!1,d==200||d==201?this.totalClick=u.total_clicks:(this.errorMessage=u.message,this.errorInput=!0)}catch(l){this.errorMessage=l}}},mounted(){this.$i18n.locale="ru",console.log(this.$i18n.availableLocales)},created(){this.userInfo=JSON.parse(localStorage.getItem("user"));const s=localStorage.getItem("currentPage");s&&(this.currentPage=parseInt(s)),this.requestApi(1)}},h=s=>(T("data-v-11f46605"),s=s(),A(),s),E={class:"row"},N={class:"col-md-3"},q={class:"col-md-3 text-right text-danger",style:{display:"flex","align-items":"center","justify-content":"flex-end"}},j={class:"col-md-6 text-center",style:{display:"flex","align-items":"center"}},L={key:0,class:"ti ti-reload anim"},U=k(" Check"),O={key:0,class:"ml-2"},z={class:"mt-3"},J={class:"row"},V={class:"col-12"},F={class:"table-responsive"},G={class:"table"},H=h(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Body"),e("th",{scope:"col"},"Start"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Target"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Actions")])],-1)),R=k("SMS "),K={key:0},Q={class:"actions"},W=["onClick"],X=h(()=>e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1)),Y=[X],Z=["onClick"],ee=h(()=>e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Edit"},null,-1)),te=[ee],se={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},oe={class:"modal-dialog",role:"document"},re={class:"modal-content"},le=h(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete inbox"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1)),ie={class:"modal-body text-center"},ne={class:"error"},ae={key:1,class:"error"},ce={key:2,class:"success"},de=h(()=>e("h4",null,"Are you sure you want to delete this inbox?",-1)),ue={class:"modal-footer"},he=h(()=>e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1)),pe=["disabled"],me={key:0,class:"loading"},ge=h(()=>e("img",{src:B},null,-1)),_e=[ge];function fe(s,l,u,d,t,o){const y=g("CrudButton"),v=g("Pagination");return i(),n(p,null,[e("div",E,[e("div",N,[t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(i(),_(y,{key:0,urlName:"sms.add",btnName:"Send Message"})):a("",!0)]),e("div",q,c(t.errorMessage),1),e("div",j,[M(e("input",{type:"text",class:f(["form-control w-50",{"border-danger text-danger":t.errorInput}]),"onUpdate:modelValue":l[0]||(l[0]=r=>t.checkModel=r),placeholder:"https://bit.ly/xxxxxx"},null,2),[[P,t.checkModel]]),e("div",{class:f(["btn btn-primary ml-2",{disabled:t.load}]),onClick:l[1]||(l[1]=(...r)=>o.checkLink&&o.checkLink(...r))},[t.load?(i(),n("i",L)):a("",!0),U],2),t.totalClick!=null?(i(),n("span",O,"Total clicks: "+c(t.totalClick),1)):a("",!0)])]),e("div",z,[e("div",J,[e("div",V,[e("div",F,[e("table",G,[H,e("tbody",null,[(i(!0),n(p,null,b(t.inboxes,r=>(i(),n("tr",{key:r.id},[r?(i(),n(p,{key:0},[e("td",null,c(JSON.parse(r.descriptionText).uz),1),e("td",null,c(r.startDate),1),e("td",null,[R,r.sentBy=="SMS to phone Number"&&r.used?(i(),n("span",K,"delivered")):a("",!0)]),e("td",null,c(r.targetName),1),e("td",null,c(r.used?"Deactived":o.checkStatus(r.startDate)),1),e("td",Q,[!r.used&&t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(i(),n("div",{key:0,onClick:m=>o.editinbox(r.id),class:"edit mr-2 cursor-pointer"},Y,8,W)):a("",!0),r.used&&t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(i(),n("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:m=>o.openmodel(r.id,JSON.parse(r.titleName).ru),class:"delete text-danger"},te,8,Z)):a("",!0)])],64)):a("",!0)]))),128))])])]),t.last_page!=1?(i(),_(v,{key:0,"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":t.currentPage,onPagechanged:o.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])):a("",!0)])])]),e("div",se,[e("div",oe,[e("div",re,[le,e("div",ie,[t.resError?(i(!0),n(p,{key:0},b(t.resError,(r,m)=>(i(),n("p",ne,c(m)+" : "+c(r[0]),1))),256)):a("",!0),t.resStringError?(i(),n("p",ae,c(t.resStringError),1)):a("",!0),t.resSuccess?(i(),n("p",ce,c(t.resSuccess),1)):a("",!0),de,e("h4",null,c(t.modelName),1),e("p",null,"inboxId: "+c(t.modelUserId),1)]),e("div",ue,[he,t.submitButton?(i(),n("button",{key:0,disabled:t.disabled,type:"button",onClick:l[2]||(l[2]=(...r)=>o.requestApiDelete&&o.requestApiDelete(...r)),class:"btn btn-primary"},"Delete inbox",8,pe)):a("",!0)])])])]),t.loading?(i(),n("div",me,_e)):a("",!0)],64)}const Ie=w(D,[["render",fe],["__scopeId","data-v-11f46605"]]);export{Ie as default};
