import{C as S,P as v}from"./Pagination.b8ff8fbc.js";import{L as w}from"./LanguageSwitcher.c9c9f8e9.js";import{s as k}from"./globalFunction.5ce06618.js";import{_ as x,r as g,o as l,c as i,a as e,b as _,d as c,f as C,F as p,e as f,t as a,g as N,a2 as B,a3 as D,h as P}from"./index.34e73fda.js";const A={data(){return{imageUrl:"https://api.pharmiq.uz/files/inboxMessage/",disabled:!1,modelName:"",modelUserId:"",currentPage:1,last_page:1,total:1,per_page:1,inboxes:[],response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,inboxesearch:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:S,Pagination:v,LanguageSwitcher:w},computed:{},methods:{checkStatus(t,n){let u=new Date(t),d=new Date(n);return d&&new Date>d?"Deactived":u>new Date?"upgoing":(u<=new Date,"ongoing")},showImageUrl(t){return this.imageUrl+t},searchinbox(){clearTimeout(this.timerId),this.inboxesearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.inboxesearch)},2e3)):(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showinbox(t){this.$router.push({name:"inboxes.show",params:{id:t}})},openmodel(t,n){this.modelUserId=t,this.modelName=n,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editinbox(t){this.$router.push({name:"inboxes.edit",params:{id:t}})},onPageChange(t){console.log(t),this.currentPage=t,this.loading=!0,this.requestApi(t),localStorage.setItem("currentPage",t)},refreshList(){this.loading=!0,this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const t={usid:this.modelUserId},n=k(),u=Object.assign(t,n);try{let d=localStorage.getItem("token");console.log(this.modelUserId);const o=await(await fetch(this.url+"api/v1/inbox/delete/"+this.modelUserId,{method:"POST",body:JSON.stringify(u),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+d}})).json();o.error?typeof o.message=="object"?this.resError=o.message:this.resStringError=o.message:(this.resSuccess="Successfully Deleted",this.disabled=!1,this.requestApi(1),this.submitButton=!1)}catch(d){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",d)}},requestApi(t,n=null){let u=this.url+"api/v1/inbox?page="+t;n&&(u=this.url+"api/v1/inbox?page=1&search="+n);let d=localStorage.getItem("token");const s={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+d})};fetch(u,s).then(o=>(o.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{this.response=o,this.last_page=o.last_page,this.total=o.total,this.per_page=o.per_page,this.inboxes=o.data,console.log(o.data),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},mounted(){this.$i18n.locale="ru",console.log(this.$i18n.availableLocales)},created(){this.userInfo=JSON.parse(localStorage.getItem("user"));const t=localStorage.getItem("currentPage");t&&(this.currentPage=parseInt(t)),this.requestApi(1)}},h=t=>(B("data-v-5dbdff66"),t=t(),D(),t),E={class:"row"},q={class:"col-md-3"},T=h(()=>e("div",{class:"col-md-6"},null,-1)),U={class:"col-md-3 text-center"},L={class:"mt-3"},O={class:"row"},j={class:"col-12"},z={class:"table-responsive"},M={class:"table"},J=h(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Banner"),e("th",{scope:"col",style:{width:"120px",overflow:"hidden"}},"Title"),e("th",{scope:"col"},"Start"),e("th",{scope:"col"},"End"),e("th",{scope:"col"},"Send By"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Target"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Actions")])],-1)),V=["src"],F={style:{width:"120px",overflow:"hidden"}},G={key:0},H={class:"actions"},R=["onClick"],K=h(()=>e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1)),Q=[K],W=["onClick"],X=h(()=>e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Edit"},null,-1)),Y=[X],Z={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ee={class:"modal-dialog",role:"document"},te={class:"modal-content"},se=h(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete inbox"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1)),oe={class:"modal-body text-center"},re={class:"error"},le={key:1,class:"error"},ie={key:2,class:"success"},ae=h(()=>e("h4",null,"Are you sure you want to delete this inbox?",-1)),ne={class:"modal-footer"},ce=h(()=>e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1)),de=["disabled"],ue={key:0,class:"loading"},he=h(()=>e("img",{src:P},null,-1)),pe=[he];function me(t,n,u,d,s,o){const b=g("CrudButton"),y=g("LanguageSwitcher"),I=g("Pagination");return l(),i(p,null,[e("div",E,[e("div",q,[s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(l(),_(b,{key:0,urlName:"inboxes.add",btnName:"Add Inbox"})):c("",!0)]),T,e("div",U,[C(y)])]),e("div",L,[e("div",O,[e("div",j,[e("div",z,[e("table",M,[J,e("tbody",null,[(l(!0),i(p,null,f(s.inboxes,r=>(l(),i("tr",{key:r.id},[r?(l(),i(p,{key:0},[e("td",null,[e("img",{src:o.showImageUrl(r.messageIcon),alt:"",width:"80"},null,8,V)]),e("td",F,a(t.$i18n.locale=="ru"?JSON.parse(r.titleName).ru:JSON.parse(r.titleName).uz),1),e("td",null,a(r.startDate),1),e("td",null,a(r.endDate),1),e("td",null,[N(a(r.sentBy)+" ",1),r.sentBy=="SMS to phone Number"&&r.used?(l(),i("span",G,"\u2713")):c("",!0)]),e("td",null,a(r.messageType),1),e("td",null,a(r.targetName),1),e("td",null,a(o.checkStatus(r.startDate,r.endDate)),1),e("td",H,[s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(l(),i("div",{key:0,onClick:m=>o.editinbox(r.id),class:"edit mr-2 cursor-pointer"},Q,8,R)):c("",!0),s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(l(),i("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:m=>o.openmodel(r.id,JSON.parse(r.titleName).ru),class:"delete text-danger"},Y,8,W)):c("",!0)])],64)):c("",!0)]))),128))])])]),s.last_page!=1?(l(),_(I,{key:0,"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":s.currentPage,onPagechanged:o.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])):c("",!0)])])]),e("div",Z,[e("div",ee,[e("div",te,[se,e("div",oe,[s.resError?(l(!0),i(p,{key:0},f(s.resError,(r,m)=>(l(),i("p",re,a(m)+" : "+a(r[0]),1))),256)):c("",!0),s.resStringError?(l(),i("p",le,a(s.resStringError),1)):c("",!0),s.resSuccess?(l(),i("p",ie,a(s.resSuccess),1)):c("",!0),ae,e("h4",null,a(s.modelName),1),e("p",null,"inboxId: "+a(s.modelUserId),1)]),e("div",ne,[ce,s.submitButton?(l(),i("button",{key:0,disabled:s.disabled,type:"button",onClick:n[0]||(n[0]=(...r)=>o.requestApiDelete&&o.requestApiDelete(...r)),class:"btn btn-primary"},"Delete inbox",8,de)):c("",!0)])])])]),s.loading?(l(),i("div",ue,pe)):c("",!0)],64)}const ye=x(A,[["render",me],["__scopeId","data-v-5dbdff66"]]);export{ye as default};
