import{C as v,P as I}from"./Pagination.b8ff8fbc.js";import{L as y}from"./LanguageSwitcher.c9c9f8e9.js";import{s as k}from"./globalFunction.5ce06618.js";import{_ as w,r as _,o as l,c as n,a as e,b as g,d as c,F as m,e as f,t as i,a2 as P,a3 as C,h as A}from"./index.34e73fda.js";const D={data(){return{imageUrl:"https://api.pharmiq.uz/files/promocode/",disabled:!1,modelName:"",modelUserId:"",currentPage:1,last_page:1,total:1,per_page:1,promocodes:[],response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,promocodeSearch:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:v,Pagination:I,LanguageSwitcher:y},computed:{},methods:{checkStatus(o,a){let u=new Date(o);return a&&new Date>new Date(a)?"Not active":u>new Date?(console.log(u,new Date),"Active"):(u<=new Date,"Ongoing")},searchpromocode(){clearTimeout(this.timerId),this.promocodeSearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.promocodeSearch)},2e3)):(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showpromocode(o){this.$router.push({name:"promocodes.show",params:{id:o}})},openmodel(o,a){this.modelUserId=o,this.modelName=a,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editpromocode(o){this.$router.push({name:"promocodes.edit",params:{id:o}})},onPageChange(o){console.log(o),this.currentPage=o,this.loading=!0,this.requestApi(o),localStorage.setItem("currentPageP",o)},refreshList(){this.loading=!0,this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const o={usid:this.modelUserId},a=k(),u=Object.assign(o,a);try{let h=localStorage.getItem("token");const s=await(await fetch(this.url+"api/v1/promocode/delete/"+this.modelUserId,{method:"POST",body:JSON.stringify(u),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+h}})).json();s.error?typeof s.message=="object"?this.resError=s.message:this.resStringError=s.message:(this.resSuccess="Successfully Deleted",this.requestApi(1),this.submitButton=!1)}catch(h){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",h)}},requestApi(o,a=null){let u=this.url+"api/v1/promocode?page="+o,h=localStorage.getItem("token");const t={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+h})};fetch(u,t).then(s=>(s.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),s.json())).then(s=>{this.response=s,this.last_page=s.last_page,this.total=s.total,this.per_page=s.per_page,this.promocodes=s.data,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},mounted(){this.$i18n.locale="ru",console.log(this.$i18n.availableLocales)},created(){this.userInfo=JSON.parse(localStorage.getItem("user"));const o=localStorage.getItem("currentPageP");o&&(this.currentPage=parseInt(o)),this.requestApi(1)}},d=o=>(P("data-v-f734b56b"),o=o(),C(),o),E={class:"row"},q={class:"col-md-3"},x=d(()=>e("div",{class:"col-md-6"},null,-1)),B=d(()=>e("div",{class:"col-md-3 text-center"},null,-1)),N={class:"mt-3"},O={class:"row"},j={class:"col-12"},L={class:"table-responsive"},T={class:"table"},U=d(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"PromoCode"),e("th",{scope:"col"},"Price"),e("th",{scope:"col"},"Start"),e("th",{scope:"col"},"End"),e("th",{scope:"col"},"Amount"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Actions")])],-1)),z={class:"actions"},M=["onClick"],F=d(()=>e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1)),J=[F],V=["onClick"],G=d(()=>e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Edit"},null,-1)),H=[G],R={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},W={class:"modal-dialog",role:"document"},K={class:"modal-content"},Q=d(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete promocode"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1)),X={class:"modal-body text-center"},Y={class:"error"},Z={key:1,class:"error"},ee={key:2,class:"success"},te=d(()=>e("h4",null,"Are you sure you want to delete this promocode?",-1)),oe={class:"modal-footer"},se=d(()=>e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1)),re=["disabled"],le={key:0,class:"loading"},ie=d(()=>e("img",{src:A},null,-1)),ne=[ie];function ae(o,a,u,h,t,s){const b=_("CrudButton"),S=_("Pagination");return l(),n(m,null,[e("div",E,[e("div",q,[t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),g(b,{key:0,urlName:"promocodes.add",btnName:"Add Promocode"})):c("",!0)]),x,B]),e("div",N,[e("div",O,[e("div",j,[e("div",L,[e("table",T,[U,e("tbody",null,[(l(!0),n(m,null,f(t.promocodes,r=>(l(),n("tr",{key:r.id},[e("td",null,i(r.promocode),1),e("td",null,i(r.prizeAmount),1),e("td",null,i(r.startDate),1),e("td",null,i(r.endDate),1),e("td",null,i(r.amountOfWinners),1),e("td",null,i(s.checkStatus(r.startDate,r.endDate)),1),e("td",z,[t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),n("div",{key:0,onClick:p=>s.editpromocode(r.id),class:"edit mr-2 cursor-pointer"},J,8,M)):c("",!0),t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),n("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:p=>s.openmodel(r.id,r.promocode),class:"delete text-danger"},H,8,V)):c("",!0)])]))),128))])])]),t.last_page!=1?(l(),g(S,{key:0,"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":t.currentPage,onPagechanged:s.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])):c("",!0)])])]),e("div",R,[e("div",W,[e("div",K,[Q,e("div",X,[t.resError?(l(!0),n(m,{key:0},f(t.resError,(r,p)=>(l(),n("p",Y,i(p)+" : "+i(r[0]),1))),256)):c("",!0),t.resStringError?(l(),n("p",Z,i(t.resStringError),1)):c("",!0),t.resSuccess?(l(),n("p",ee,i(t.resSuccess),1)):c("",!0),te,e("h4",null,i(t.modelName),1),e("p",null,"promocodeId: "+i(t.modelUserId),1)]),e("div",oe,[se,t.submitButton?(l(),n("button",{key:0,disabled:t.disabled,type:"button",onClick:a[0]||(a[0]=(...r)=>s.requestApiDelete&&s.requestApiDelete(...r)),class:"btn btn-primary"},"Delete promocode",8,re)):c("",!0)])])])]),t.loading?(l(),n("div",le,ne)):c("",!0)],64)}const pe=w(D,[["render",ae],["__scopeId","data-v-f734b56b"]]);export{pe as default};
