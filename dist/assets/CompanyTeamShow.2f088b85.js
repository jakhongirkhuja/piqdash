import{G as b}from"./GoBackButton.8ec57f12.js";import{c as k}from"./vue-datepicker.es.17b3f44e.js";import{h as S}from"./maska.esm.cd315c5a.js";import{u as w,r as T,m as j,b as g}from"./index.esm.b21b73c4.js";import{_ as I,a4 as N,a5 as C,r as E,o as l,c as d,f as z,a as t,t as u,F as h,e as y,d as v,a2 as A,a3 as B}from"./index.34e73fda.js";import{s as f}from"./globalFunction.5ce06618.js";const q={setup(){return{v$:w()}},directives:{maska:S},components:{GoBackButton:b,Datepicker:k,yandexMap:N,ymapMarker:C},data(){return{url:"https://api.pharmiq.uz/",hideGroups:!0,city_id:14,region_id:192,employees:[],members:[],companyName:"",companyId:0,banner_ru:[],banner_ru_prev:null,banner_uz:[],banner_uz_prev:null,title_ru:"",title_uz:"",body_ru:"",startDate:null,endDate:null,body_uz:"",categories:[],added:!1,resError:!1,resSuccess:!1,resStringError:"",userInfo:null,monetized:!1,price:0,category_id:1,storeLandmark_ru:"",storeLandmark_uz:"",lat:null,long:null,cities:[],regions:[]}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{title_ru:{required:T,minLengthValue:j(5)},city_id:{required:g(()=>this.hideGroups)},region_id:{required:g(()=>this.hideGroups)},storeLandmark_ru:{required:g(()=>this.hideGroups)}}},methods:{onChangeCities(r){this.getRegions(r.target.value)},async removeMember(r){const m={user_id:r,team_id:this.$route.params.team_id},c=f(),e=Object.assign(m,c);var s=new FormData;for(const o in e)s.append(o,e[o]);let i=!0;if(i){i=!1;try{let o=localStorage.getItem("token");const a=await fetch(this.url+"api/v1/company/team/users/delete",{method:"POST",body:s,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+o}}),n=await a.json();window.scrollTo({top:0,behavior:"smooth"});const _=a.status;setTimeout(()=>{i=!0},2e3),_==401?this.resStringError=n.message:n.error?typeof n.message=="object"?this.resError=n.message:this.resStringError=n.message:this.getCompanyTeamUsers()}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",o),setTimeout(()=>{i=!0},2e3)}}},async addMember(r){const m={user_id:r,team_id:this.$route.params.team_id},c=f(),e=Object.assign(m,c);var s=new FormData;for(const o in e)s.append(o,e[o]);let i=!0;if(i){i=!1;try{let o=localStorage.getItem("token");const a=await fetch(this.url+"api/v1/company/team/users/add",{method:"POST",body:s,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+o}}),n=await a.json();window.scrollTo({top:0,behavior:"smooth"});const _=a.status;setTimeout(()=>{i=!0},2e3),_==401?this.resStringError=n.message:n.error?typeof n.message=="object"?this.resError=n.message:this.resStringError=n.message:this.getCompanyTeamUsers()}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",o),setTimeout(()=>{i=!0},2e3)}}},async requestApi(){const r={company_id:this.$route.params.company_id,team_id:this.$route.params.team_id,teamName:this.title_ru,teamType:this.monetized?1:0},m=f(),c=Object.assign(r,m);var e=new FormData;for(const s in c)e.append(s,c[s]);this.monetized==!1&&(e.append("city_id",this.city_id),e.append("region_id",this.region_id),e.append("addressType",1),e.append("addressline",this.storeLandmark_ru),this.lat&&this.long&&(e.append("latitude",this.lat),e.append("longitude",this.long)));try{let s=localStorage.getItem("token");const i=await fetch(this.url+"api/v1/company/team/update",{method:"POST",body:e,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+s}}),o=await i.json();window.scrollTo({top:0,behavior:"smooth"}),i.status==401?this.resStringError=o.message:o.error?typeof o.message=="object"?this.resError=o.message:this.resStringError=o.message:this.resSuccess="Company Team Successfully Added"}catch(s){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",s)}},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},getvalue(){this.monetized?this.hideGroups=!1:(this.hideGroups=!0,this.showmap())},getCompanyTeamUsers(){let r=this.url+"api/v1/company/team/users/list/"+this.$route.params.team_id,m=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+m})};fetch(r,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.members=e.teamMembers,this.employees=e.notAlocated})},getCompanyById(){let r=this.url+"api/v1/company/getCompanyId/"+this.$route.params.company_id,m=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+m})};fetch(r,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{e!=null&&(this.companyId=e.id,this.companyName=e.companyName)})},getTeam(){let r=this.url+"api/v1/company/team/show/"+this.$route.params.company_id+"?team_id="+this.$route.params.team_id,m=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+m})};fetch(r,c).then(e=>(e.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{e.companyTeams?(this.title_ru=e.companyTeams.teamName,this.monetized=e.companyTeams.teamType):this.resStringError="Team not found"})}},created(){this.userInfo=JSON.parse(localStorage.getItem("user")),this.getCompanyById(),this.getTeam(),this.getCompanyTeamUsers()}},p=r=>(A("data-v-c873c878"),r=r(),B(),r),G={class:"mt-3"},M={class:"row"},L={class:"col-md-12 grid-margin stretch-card"},U={class:"card"},$={class:"card-body"},D={class:"card-title"},F={class:"error"},O={key:1,class:"error"},x={key:2,class:"success"},P={class:"form-group row"},R={class:"col-md-12"},V=p(()=>t("h5",null,"Members",-1)),H={class:"members mb-3"},J=p(()=>t("div",{class:"title"},[t("div",{class:"title__name"},"Name"),t("div",{class:"title__phoneNumber"},"PhoneNumber"),t("div",{class:"title__action"},"Actions")],-1)),K={class:"name"},Q={class:"phoneNumber"},W=["onClick"],X={key:1,class:"members__not"},Y={class:"col-md-12"},Z=p(()=>t("h5",null,"Not Alocated Employees",-1)),ee={class:"members"},te=p(()=>t("div",{class:"title"},[t("div",{class:"title__name"},"Name"),t("div",{class:"title__phoneNumber"},"PhoneNumber"),t("div",{class:"title__action"},"Actions")],-1)),se={class:"name"},oe={class:"phoneNumber"},re=["onClick"],ae={key:1,class:"members__not"};function ie(r,m,c,e,s,i){const o=E("GoBackButton");return l(),d(h,null,[z(o),t("div",G,[t("div",M,[t("div",L,[t("div",U,[t("div",$,[t("h4",D,u(s.title_ru),1),s.resError?(l(!0),d(h,{key:0},y(s.resError,(a,n)=>(l(),d("p",F,u(n)+" : "+u(a[0]),1))),256)):v("",!0),s.resStringError?(l(),d("p",O,u(s.resStringError),1)):v("",!0),s.resSuccess?(l(),d("p",x,u(s.resSuccess),1)):v("",!0),t("div",P,[t("div",R,[V,t("div",H,[J,s.members.length>0?(l(!0),d(h,{key:0},y(s.members,a=>(l(),d("div",{class:"members__each",key:a.user_id},[t("div",K,u(a.name),1),t("div",Q,u(a.phoneNumber),1),t("div",{class:"remove",title:"Remove From Team",onClick:n=>i.removeMember(a.user_id)},"-",8,W)]))),128)):(l(),d("div",X,"No Members"))])]),t("div",Y,[Z,t("div",ee,[te,s.employees.length>0?(l(!0),d(h,{key:0},y(s.employees,a=>(l(),d("div",{class:"members__each",key:a.user_id},[t("div",se,u(a.name),1),t("div",oe,u(a.phoneNumber),1),t("div",{class:"add",onClick:n=>i.addMember(a.user_id)},"+",8,re)]))),128)):(l(),d("div",ae,"No Members"))])])])])])])])])],64)}const he=I(q,[["render",ie],["__scopeId","data-v-c873c878"]]);export{he as default};
