import{G as x}from"./GoBackButton.8ec57f12.js";import{c as L}from"./vue-datepicker.es.17b3f44e.js";import{h as I}from"./maska.esm.cd315c5a.js";import{u as T,r as _,m as D,i as U,a as E}from"./index.esm.b21b73c4.js";import{s as z}from"./globalFunction.5ce06618.js";import{e as k}from"./exportFromJSON.de0e6beb.js";import{C,a as q,P as w}from"./ckeditor.713c8e1a.js";import{_ as j,r as F,o as i,c as l,f as V,a as e,F as h,e as p,d as S,t as d,w as g,v as f,n as v,a2 as $,a3 as B}from"./index.34e73fda.js";import"./_commonjsHelpers.712cc82f.js";import"./vue.runtime.esm-bundler.cd7c4a87.js";const N={setup(){return{v$:T()}},directives:{maska:I},components:{GoBackButton:x,Datepicker:L,ckeditor:C.component},data(){return{url:"https://api.pharmiq.uz/",name:"",description:"",startDate:null,endDate:null,minDate:"",limit:null,deadline:null,course_id:null,resSuccess:null,course_name:"",resError:[],courseSearch:"",courses:[],logs:[],exportLog:[],resStringError:"",editor:q,editorData_ru:"<p>lottery content ru</p>",editorData_uz:"<p>lottery content uz</p>",editorConfig:{}}},computed:{isDisabled:function(){if(this.v$.$touch(),console.log(this.v$.$touch()),this.v$.$error)return!0}},validations(){return{name:{required:_,minLengthValue:D(3)},description:{required:_,minLengthValue:D(3)},limit:{required:_,integer:U,maxLengthValue:E(5)},startDate:{required:_},deadline:{required:_},endDate:{required:_},course_id:{required:_}}},methods:{handleChange(n,o,a){this.changeUserStatus(n.target.checked,o,a)},downloadFile(){const n=this.name,o=k.types.csv,a=this.exportLog;a&&k({data:a,fileName:n,exportType:o})},chooseCourse(n,o){this.course_id=n,this.course_name=o,this.courses=[]},async changeUserStatus(n,o,a){const s={lottery_log_id:o,status:n?1:0,user_id:a};console.log(s);const r=z(),u=Object.assign(s,r);var b=new FormData;for(const t in u)b.append(t,u[t]);try{let t=localStorage.getItem("token");const c=await fetch(this.url+"api/v1/lottery/updateStatus",{method:"POST",body:b,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+t}}),y=await c.json();window.scrollTo({top:0,behavior:"smooth"}),c.status==401?(this.resStringError=y.message,alert("Error")):y.error?(alert("Error"),typeof y.message=="object"?this.resError=y.message:this.resStringError=y.message):alert("User Successfully Updated")}catch(t){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t)}},searchcourse(){clearTimeout(this.timerId),this.courseSearch!=""&&this.courseSearch.length>3?this.timerId=setTimeout(()=>{this.requestApiSearch(1,this.courseSearch)},2e3):this.courses=[]},requestApiSearch(n,o=null){let a=this.url+"api/v1/course?page="+n;o&&(a=this.url+"api/v1/course?page=1&search="+o);let s=localStorage.getItem("token");const r={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s})};fetch(a,r).then(u=>(u.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),u.json())).then(u=>{this.courses=u.data,console.log(this.courses),setTimeout(()=>{this.loading=!1},1e3)})},inputgetseconds(n){if(n=="ru"){document.querySelector("#video_ru").innerHTML=this.video_ru;let a=document.querySelector("#video_ru iframe");const s=new w(a);var o=this;s.getDuration().then(function(r){o.video_ru_length=r}).catch(function(r){console.log(r)})}else{document.querySelector("#video_uz").innerHTML=this.video_uz;let a=document.querySelector("#video_uz iframe");const s=new w(a);var o=this;s.getDuration().then(function(u){o.video_uz_length=u}).catch(function(u){console.log(u)})}},uploadFilebannerRu(n){var o=n.target.files||n.dataTransfer.files;!o.length||(this.banner_ru=o[0],this.banner_ru_prev=URL.createObjectURL(o[0]))},uploadFilebannerUz(n){var o=n.target.files||n.dataTransfer.files;!o.length||(this.banner_uz=o[0],this.banner_uz_prev=URL.createObjectURL(o[0]))},async requestApi(){},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},checkvalue(){console.log(this.startDate)},getvalue(){console.log(this.monetized)},requestApiGetFirst(){let n=this.url+"api/v1/lottery?lottery_id="+this.$route.params.id+"&logs=true",o=localStorage.getItem("token");const a={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+o})};fetch(n,a).then(s=>(s.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),s.json())).then(s=>{console.log(s),s.lottery&&(this.name=s.lottery.name,this.description=s.lottery.description,this.startDate=s.lottery.startDate.split(" ")[0],this.endDate=s.lottery.endDate.split(" ")[0],this.deadline=s.lottery.deadline.split(" ")[0],this.limit=s.lottery.limit,this.course_id=s.lottery.course_id,this.course_name=JSON.parse(s.lottery.course.getinfo.courseTitleName).ru),this.logs=s.logs,this.exportLog=s.export,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},created(){const n=new Date,o=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");this.minDate=`${o}-${a}-${s}`,this.requestApiGetFirst()}},m=n=>($("data-v-f234684e"),n=n(),B(),n),A={class:"mt-3"},G={class:"row"},R={class:"col-md-12 grid-margin stretch-card"},O={class:"card"},H={class:"card-body"},M=m(()=>e("h4",{class:"card-title"},"Lottery",-1)),P={class:"error"},J={key:1,class:"error"},Z={key:2,class:"success"},K={class:"forms-sample"},W={class:"form-group row"},Y={class:"col-md-5"},Q=m(()=>e("label",{for:"exampleInputTitleRu"},"Name",-1)),X={class:"col-md-5"},ee=m(()=>e("label",{for:"exampleInputTitleUZ"},"Description",-1)),te={class:"col-md-2"},oe=m(()=>e("label",{for:"exampleInputLimit"},"Limit",-1)),se={class:"form-group row"},re={class:"col-md-4"},ne=m(()=>e("label",{for:"exampleInputStartDate"},"Start Date",-1)),ie=["min"],le={class:"col-md-4"},ae=m(()=>e("label",{for:"exampleInputEnddate"},"End Date",-1)),ce=["min"],de={class:"col-md-4"},ue=m(()=>e("label",{for:"exampleInputLimit"},"Deadline",-1)),me=["min"],he={class:"row"},pe={class:"col-md-12"},_e=m(()=>e("label",{for:"exampleInputLimit"},"Course ",-1)),ge=m(()=>e("br",null,null,-1)),fe={class:"row"},ve={class:"col-md-12"},ye={class:"card"},be={class:"card-body"},Se={class:"table-responsive"},De={class:"table"},ke=m(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Ticket"),e("th",{scope:"col"},"FirstName"),e("th",{scope:"col"},"LastName"),e("th",{scope:"col"},"Order"),e("th",{scope:"col"},"Datetime"),e("th",{scope:"col"},"Status")])],-1)),we=["checked","onChange","id"],xe=["for"];function Le(n,o,a,s,r,u){const b=F("GoBackButton");return i(),l(h,null,[V(b),e("div",A,[e("div",G,[e("div",R,[e("div",O,[e("div",H,[M,r.resError?(i(!0),l(h,{key:0},p(r.resError,(t,c)=>(i(),l("p",P,d(c)+" : "+d(t[0]),1))),256)):S("",!0),r.resStringError?(i(),l("p",J,d(r.resStringError),1)):S("",!0),r.resSuccess?(i(),l("p",Z,d(r.resSuccess),1)):S("",!0),e("form",K,[e("div",W,[e("div",Y,[Q,g(e("input",{type:"text",class:v(["form-control",{"border border-danger":s.v$.name.$errors.length>0}]),id:"exampleInputTitleRu","onUpdate:modelValue":o[0]||(o[0]=t=>r.name=t),disabled:""},null,2),[[f,r.name]]),(i(!0),l(h,null,p(s.v$.name.$errors,(t,c)=>(i(),l("small",{class:"error",key:c},d(t.$message),1))),128))]),e("div",X,[ee,g(e("input",{type:"text",class:v(["form-control",{"border border-danger":s.v$.description.$errors.length>0}]),id:"exampleInputTitleUZ","onUpdate:modelValue":o[1]||(o[1]=t=>r.description=t),disabled:""},null,2),[[f,r.description]]),(i(!0),l(h,null,p(s.v$.description.$errors,(t,c)=>(i(),l("small",{class:"error",key:c},d(t.$message),1))),128))]),e("div",te,[oe,g(e("input",{type:"text",class:v(["form-control",{"border border-danger":s.v$.limit.$errors.length>0}]),id:"exampleInputLimit","onUpdate:modelValue":o[2]||(o[2]=t=>r.limit=t),disabled:""},null,2),[[f,r.limit]]),(i(!0),l(h,null,p(s.v$.limit.$errors,(t,c)=>(i(),l("small",{class:"error",key:c},d(t.$message),1))),128))])]),e("div",se,[e("div",re,[ne,g(e("input",{type:"date",disabled:"",min:r.minDate,class:v(["form-control",{"border border-danger":s.v$.startDate.$errors.length>0}]),id:"exampleInputStartDate","onUpdate:modelValue":o[3]||(o[3]=t=>r.startDate=t)},null,10,ie),[[f,r.startDate]]),(i(!0),l(h,null,p(s.v$.startDate.$errors,(t,c)=>(i(),l("small",{class:"error",key:c},d(t.$message),1))),128))]),e("div",le,[ae,g(e("input",{type:"date",disabled:"",min:r.minDate,class:v(["form-control",{"border border-danger":s.v$.endDate.$errors.length>0}]),id:"exampleInpuEnddate","onUpdate:modelValue":o[4]||(o[4]=t=>r.endDate=t)},null,10,ce),[[f,r.endDate]]),(i(!0),l(h,null,p(s.v$.endDate.$errors,(t,c)=>(i(),l("small",{class:"error",key:c},d(t.$message),1))),128))]),e("div",de,[ue,g(e("input",{type:"date",disabled:"",min:r.minDate,class:v(["form-control",{"border border-danger":s.v$.deadline.$errors.length>0}]),id:"exampleInputLimit","onUpdate:modelValue":o[5]||(o[5]=t=>r.deadline=t)},null,10,me),[[f,r.deadline]]),(i(!0),l(h,null,p(s.v$.deadline.$errors,(t,c)=>(i(),l("small",{class:"error",key:c},d(t.$message),1))),128))])]),e("div",he,[e("div",pe,[_e,ge,e("b",null,d(r.course_name),1)])])])])])])]),e("div",fe,[e("div",ve,[e("div",ye,[e("div",be,[e("div",Se,[e("div",{class:"btn btn-primary float-right mb-2",onClick:o[6]||(o[6]=t=>u.downloadFile())},"Export"),e("table",De,[ke,e("tbody",null,[(i(!0),l(h,null,p(r.logs,t=>(i(),l("tr",null,[e("td",null,d(t.ticket),1),e("td",null,d(t.firstName),1),e("td",null,d(t.lastName),1),e("td",null,d(t.order),1),e("td",null,d(t.datetime),1),e("td",null,[e("input",{type:"checkbox",checked:t.hasWon,class:"ios8-switch ios8-switch-lg",onChange:c=>u.handleChange(c,t.id,t.user_id),id:t.ticket},null,40,we),e("label",{for:t.ticket},null,8,xe)])]))),256))])])])])])])])])],64)}const Be=j(N,[["render",Le],["__scopeId","data-v-f234684e"]]);export{Be as default};
