import{C as k,P as I}from"./Pagination.b8ff8fbc.js";import{s as _}from"./globalFunction.5ce06618.js";import{_ as S,r as b,o as i,c,a as e,b as w,d as h,w as C,v as P,n as f,F as g,e as v,f as x,t as n,g as y,h as N}from"./index.34e73fda.js";const U={data(){return{load:!1,disabled:!1,modelName:"",modelPhone:"",modelUserId:"",currentPage:1,last_page:1,total:1,per_page:1,users:[],response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,phone:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:k,Pagination:I},computed:{},methods:{searchPhone(){this.phone=this.phone.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/g,"$1"),clearTimeout(this.timerId),this.phone!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.phone)},2e3)):(this.loading=!0,this.phone="",localStorage.removeItem("search"),this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showUser(l){this.$router.push({name:"users.show",params:{id:l}})},openmodel(l,r,d){this.modelUserId=l,this.modelName=d,this.modelPhone=r,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editUser(l){this.$router.push({name:"users.edit",params:{id:l}})},onPageChange(l){console.log(l),this.currentPage=l,this.loading=!0,this.requestApi(l),localStorage.setItem("currentPageUser",l)},async exportComp(){if(!this.load){this.load=!0;const l={export:""},r=_(),d=Object.assign(l,r);try{let a=localStorage.getItem("token");const o=await(await fetch(this.url+"api/v1/admin/export/users",{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+a},responseType:"blob"})).blob(),m=window.URL.createObjectURL(new Blob([o])),u=document.createElement("a");u.href=m,u.setAttribute("download","userExport.xlsx"),document.body.appendChild(u),u.click(),setTimeout(()=>{this.load=!1},2e3)}catch(a){alert(a),console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",a)}}},refreshList(){this.loading=!0,localStorage.removeItem("search"),this.phone="",this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const l={user_id:this.modelUserId},r=_(),d=Object.assign(l,r);try{let a=localStorage.getItem("token");const o=await(await fetch(this.url+"api/v1/admin/delete/users",{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+a}})).json();o.error?typeof o.message=="object"?this.resError=o.message:this.resStringError=o.message:(this.resSuccess="Successfully Deleted",this.submitButton=!1,this.disabled=!1)}catch(a){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",a)}},requestApi(l,r=null){localStorage.setItem("currentPageUser",l),this.currentPage=l;let d=this.url+"api/v1/admin/show/users?page="+l;r&&(localStorage.setItem("search",r),d=this.url+"api/v1/admin/show/users?page=1&search="+r);let a=localStorage.getItem("token");const s={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a})};fetch(d,s).then(o=>(o.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{localStorage.setItem("users",JSON.stringify(o)),this.response=o,this.last_page=o.last_page,this.total=o.total,this.per_page=o.per_page,this.users=o.data,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},mounted(){},created(){this.userInfo=JSON.parse(localStorage.getItem("user")),console.log(this.userInfo);const l=localStorage.getItem("currentPageUser");this.currentPage=1,l&&(this.currentPage=parseInt(l));const r=localStorage.getItem("search");r?(this.phone=r,this.requestApi(this.currentPage,r)):this.requestApi(this.currentPage)}},A={class:"row"},E={class:"col-md-2"},B={class:"col-md-6"},T={class:"col-md-2"},j=y(" Export"),q={class:"col-md-2"},L=e("i",{class:"ti ti-reload"},null,-1),O=y(" refresh list"),D=[L,O],z={class:"mt-3"},M={class:"row"},R={class:"col-12"},V={class:"table-responsive"},F={class:"table"},J=e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Phone number"),e("th",{scope:"col"},"First name"),e("th",{scope:"col"},"Last name"),e("th",{scope:"col"},"Birth date"),e("th",{scope:"col"},"Gender"),e("th",{scope:"col"},"Role"),e("th",{scope:"col"},"Created at"),e("th",{scope:"col"},"Actions")])],-1),G={class:"actions"},H=["onClick"],K=e("i",{class:"ti ti-eye","data-toggle":"tooltip",title:"Show"},null,-1),Q=[K],W=["onClick"],X=e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1),Y=[X],Z=["onClick"],ee=e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Edit"},null,-1),te=[ee],se={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},oe={class:"modal-dialog",role:"document"},re={class:"modal-content"},le=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete User"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1),ne={class:"modal-body text-center"},ie={class:"error"},ae={key:1,class:"error"},ce={key:2,class:"success"},de=e("h4",null,"Are you sure you want to delete this user?",-1),he={class:"modal-footer"},ue=e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1),pe=["disabled"],me={key:0,class:"loading"},ge=e("img",{src:N},null,-1),_e=[ge];function be(l,r,d,a,s,o){const m=b("CrudButton"),u=b("Pagination");return i(),c(g,null,[e("div",A,[e("div",E,[s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(i(),w(m,{key:0,urlName:"users.add",btnName:"Add User"})):h("",!0)]),e("div",B,[C(e("input",{type:"search",onInput:r[0]||(r[0]=(...t)=>o.searchPhone&&o.searchPhone(...t)),"onUpdate:modelValue":r[1]||(r[1]=t=>s.phone=t),class:"form-control",placeholder:"Search: 998991112233"},null,544),[[P,s.phone]])]),e("div",T,[e("div",{class:"export",onClick:r[2]||(r[2]=(...t)=>o.exportComp&&o.exportComp(...t))},[e("i",{class:f(["ti",{"ti-export":!s.load,"ti-reload anim":s.load}])},null,2),j])]),e("div",q,[e("div",{class:"refresh",onClick:r[3]||(r[3]=(...t)=>o.refreshList&&o.refreshList(...t))},D)])]),e("div",z,[e("div",M,[e("div",R,[e("div",V,[e("table",F,[J,e("tbody",null,[(i(!0),c(g,null,v(s.users.filter(t=>t.phonebook),t=>(i(),c("tr",{key:t.id},[e("td",null,[e("span",{class:f({notactive:!t.phonebook.status})},n("+"+t.phonebook.phoneNumber.substring(0,3)+" ( "+t.phonebook.phoneNumber.substring(3,5)+" ) "+t.phonebook.phoneNumber.substring(5,8)+"-"+t.phonebook.phoneNumber.substring(8,10)+"-"+t.phonebook.phoneNumber.substring(10,12)),3)]),e("td",null,n(t.firstName),1),e("td",null,n(t.lastName),1),e("td",null,n(t.birthDate),1),e("td",null,n(t.gender?"Female":"Male"),1),e("td",null,n(t.role),1),e("td",null,n(new Date(t.created_at).toLocaleString()),1),e("td",G,[e("div",{onClick:p=>o.showUser(t.user_id),class:"show text-primary mr-2 cursor-pointer"},Q,8,H),s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(i(),c("div",{key:0,onClick:p=>o.editUser(t.user_id),class:"edit mr-2 cursor-pointer"},Y,8,W)):h("",!0),s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(i(),c("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:p=>o.openmodel(t.user_id,t.phonebook.phoneNumber,t.firstName),class:"delete text-danger"},te,8,Z)):h("",!0)])]))),128))])])]),x(u,{"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":s.currentPage,onPagechanged:o.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])])])]),e("div",se,[e("div",oe,[e("div",re,[le,e("div",ne,[s.resError?(i(!0),c(g,{key:0},v(s.resError,(t,p)=>(i(),c("p",ie,n(p)+" : "+n(t[0]),1))),256)):h("",!0),s.resStringError?(i(),c("p",ae,n(s.resStringError),1)):h("",!0),s.resSuccess?(i(),c("p",ce,n(s.resSuccess),1)):h("",!0),de,e("h4",null,n(s.modelName),1),e("h4",null,n(s.modelPhone),1),e("p",null,"UserId: "+n(s.modelUserId),1)]),e("div",he,[ue,s.submitButton?(i(),c("button",{key:0,disabled:s.disabled,type:"button",onClick:r[4]||(r[4]=(...t)=>o.requestApiDelete&&o.requestApiDelete(...t)),class:"btn btn-primary"},"Delete User",8,pe)):h("",!0)])])])]),s.loading?(i(),c("div",me,_e)):h("",!0)],64)}const ke=S(U,[["render",be]]);export{ke as default};
