import{C as b,P as y}from"./Pagination.b8ff8fbc.js";import{L as w}from"./LanguageSwitcher.c9c9f8e9.js";import{s as k}from"./globalFunction.5ce06618.js";import{u as C,r as N,m as A}from"./index.esm.b21b73c4.js";import{_ as T,r as g,o as l,c as n,a as e,b as f,d as c,w as P,v as q,F as m,e as _,f as L,t as u,a2 as E,a3 as x,h as B}from"./index.34e73fda.js";const D={setup(){return{v$:C()}},data(){return{imageUrl:"https://api.pharmiq.uz/files/lesson/",disabled:!1,modelName:"",modelUserId:"",currentPage:1,last_page:1,total:1,courseSearch:"",per_page:1,lessons:[],response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,lessonsearch:"",timerId:null,timerCounterId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:b,Pagination:y,LanguageSwitcher:w},validations(){return{courseSearch:{required:N,minLengthValue:A(4)}}},computed:{},methods:{searchcourse(){this.v$.$touch(),clearTimeout(this.timerId),clearInterval(this.timerCounterId),this.courseSearch.length>4&&(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.courseSearch)},2e3)),this.courseSearch==""&&(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},checkStatus(s,i){let a=new Date(s);return i&&new Date>i?"Arxived":a>new Date?(console.log(a,new Date),"upgoing"):(a<=new Date,"ongoing")},showImageUrl(s){return this.imageUrl+s},searchlesson(){clearTimeout(this.timerId),this.lessonsearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.lessonsearch)},2e3)):(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showlesson(s){this.$router.push({name:"lessons.show",params:{id:s}})},openmodel(s,i){this.modelUserId=s,this.modelName=i,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editlesson(s){this.$router.push({name:"lessons.edit",params:{id:s}})},onPageChange(s){console.log(s),this.currentPage=s,this.loading=!0,this.requestApi(s),localStorage.setItem("currentPage",s)},refreshList(){this.loading=!0,this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const s={lesson_id:this.modelUserId},i=k(),a=Object.assign(s,i);try{let d=localStorage.getItem("token");const o=await(await fetch(this.url+"api/v1/lessons/delete",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+d}})).json();o.error?typeof o.message=="object"?this.resError=o.message:this.resStringError=o.message:(this.resSuccess="Successfully Deleted",this.requestApi(1),this.submitButton=!1)}catch(d){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",d)}},requestApi(s,i=null){let a=this.url+"api/v1/lessons?page="+s;i&&(a=this.url+"api/v1/lessons?page=1&search="+i);let d=localStorage.getItem("token");const t={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+d})};fetch(a,t).then(o=>(o.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{this.response=o,this.last_page=o.last_page,this.total=o.total,this.per_page=o.per_page,this.lessons=o.data,console.log(this.lessons),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},mounted(){this.$i18n.locale="ru",console.log(this.$i18n.availableLocales)},created(){this.userInfo=JSON.parse(localStorage.getItem("user"));const s=localStorage.getItem("currentPage");s&&(this.currentPage=parseInt(s)),this.requestApi(1)}},h=s=>(E("data-v-a1429dc8"),s=s(),x(),s),O={class:"row"},U={class:"col-md-3"},j={class:"col-md-6"},z={class:"col-md-3 text-center"},J={class:"mt-3"},M={class:"row"},V={class:"col-12"},F={class:"table-responsive"},G={class:"table"},H=h(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Title"),e("th",{scope:"col"},"Course"),e("th",{scope:"col"},"Actions")])],-1)),R={class:"actions"},K=["onClick"],Q=h(()=>e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1)),W=[Q],X=["onClick"],Y=h(()=>e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Edit"},null,-1)),Z=[Y],ee={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},se={class:"modal-dialog",role:"document"},te={class:"modal-content"},oe=h(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete lesson"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1)),re={class:"modal-body text-center"},ie={class:"error"},le={key:1,class:"error"},ne={key:2,class:"success"},ae=h(()=>e("h4",null,"Are you sure you want to delete this lesson?",-1)),ce={class:"modal-footer"},ue=h(()=>e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1)),de=["disabled"],he={key:0,class:"loading"},pe=h(()=>e("img",{src:B},null,-1)),me=[pe];function ge(s,i,a,d,t,o){const S=g("CrudButton"),v=g("LanguageSwitcher"),I=g("Pagination");return l(),n(m,null,[e("div",O,[e("div",U,[t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),f(S,{key:0,urlName:"lessons.add",btnName:"Add Lesson"})):c("",!0)]),e("div",j,[P(e("input",{type:"search",onInput:i[0]||(i[0]=(...r)=>o.searchcourse&&o.searchcourse(...r)),"onUpdate:modelValue":i[1]||(i[1]=r=>t.courseSearch=r),class:"form-control",placeholder:"Search"},null,544),[[q,t.courseSearch]]),(l(!0),n(m,null,_(d.v$.courseSearch.$errors,(r,p)=>(l(),n("small",{class:"error",key:p},u(r.$message),1))),128))]),e("div",z,[L(v)])]),e("div",J,[e("div",M,[e("div",V,[e("div",F,[e("table",G,[H,e("tbody",null,[(l(!0),n(m,null,_(t.lessons,r=>(l(),n("tr",{key:r.id},[e("td",null,u(s.$i18n.locale=="ru"?JSON.parse(r.lessonTitleName).ru:JSON.parse(r.lessonTitleName).uz),1),e("td",null,u(s.$i18n.locale=="ru"?JSON.parse(r.course.infos.courseTitleName).ru:JSON.parse(r.course.infos.courseTitleName).uz),1),e("td",R,[t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),n("div",{key:0,onClick:p=>o.editlesson(r.id),class:"edit mr-2 cursor-pointer"},W,8,K)):c("",!0),t.userInfo&&(t.userInfo.role=="Creator"||t.userInfo.role=="Owner")?(l(),n("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:p=>o.openmodel(r.id,JSON.parse(r.lessonTitleName).ru),class:"delete text-danger"},Z,8,X)):c("",!0)])]))),128))])])]),t.last_page!=1?(l(),f(I,{key:0,"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":t.currentPage,onPagechanged:o.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])):c("",!0)])])]),e("div",ee,[e("div",se,[e("div",te,[oe,e("div",re,[t.resError?(l(!0),n(m,{key:0},_(t.resError,(r,p)=>(l(),n("p",ie,u(p)+" : "+u(r[0]),1))),256)):c("",!0),t.resStringError?(l(),n("p",le,u(t.resStringError),1)):c("",!0),t.resSuccess?(l(),n("p",ne,u(t.resSuccess),1)):c("",!0),ae,e("h4",null,u(t.modelName),1),e("p",null,"lessonId: "+u(t.modelUserId),1)]),e("div",ce,[ue,t.submitButton?(l(),n("button",{key:0,disabled:t.disabled,type:"button",onClick:i[2]||(i[2]=(...r)=>o.requestApiDelete&&o.requestApiDelete(...r)),class:"btn btn-primary"},"Delete lesson",8,de)):c("",!0)])])])]),t.loading?(l(),n("div",he,me)):c("",!0)],64)}const be=T(D,[["render",ge],["__scopeId","data-v-a1429dc8"]]);export{be as default};
