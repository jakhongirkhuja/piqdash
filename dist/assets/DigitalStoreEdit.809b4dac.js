import{G as b}from"./GoBackButton.8ec57f12.js";import{c as k}from"./vue-datepicker.es.17b3f44e.js";import{h as S}from"./maska.esm.cd315c5a.js";import{u as w,r as f,m as I}from"./index.esm.b21b73c4.js";import{_ as j,a4 as L,a5 as z,r as B,o as i,c as l,f as D,a as o,F as m,e as g,d as _,t as d,l as E,w as v,p as A,n as y,v as q,a2 as T,a3 as U}from"./index.34e73fda.js";import{s as C}from"./globalFunction.5ce06618.js";const G={setup(){return{v$:w()}},directives:{maska:S},components:{GoBackButton:b,Datepicker:k,yandexMap:L,ymapMarker:z},data(){return{url:"https://api.pharmiq.uz/",name:"",added:!1,resError:!1,resSuccess:!1,resStringError:"",userInfo:null,categoryID:null,categories:[],banner_ru_prev:null,banner_ru:null}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{name:{required:f,minLengthValue:I(3)},categoryID:{required:f}}},methods:{async requestApi(){this.added=!0;const a={name:this.name,category_id:this.categoryID},r=C(),c=Object.assign(a,r);var e=new FormData;this.banner_ru&&e.append("logo",this.banner_ru);for(const s in c)e.append(s,c[s]);try{let s=localStorage.getItem("token");const t=await fetch(this.url+"api/v1/store/digitalstore/edit/"+this.$route.params.id,{method:"POST",body:e,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+s}}),u=await t.json();window.scrollTo({top:0,behavior:"smooth"}),t.status==401?(this.resStringError=u.message,this.added=!1):u.error?(typeof u.message=="object"?this.resError=u.message:this.resStringError=u.message,this.added=!1):this.resSuccess="Store Successfully Updated"}catch(s){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",s)}},uploadFilebannerRu(a){var r=a.target.files||a.dataTransfer.files;if(!r.length){this.banner_ru=[],this.banner_ru_prev="";return}this.banner_ru=r[0],this.banner_ru_prev=URL.createObjectURL(r[0])},getAddressByCoor(a,r){this.lat=a,this.long=r;let c=this.url+"api/v1/getAdressByCoor?lat="+a+"&long="+r,e=localStorage.getItem("token");const s={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e})};fetch(c,s).then(t=>(t.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),t.json())).then(t=>{this.storeLandmark_ru="",this.storeLandmark_uz="",t.street||t.house?(t.street&&(this.storeLandmark_ru+=t.street,this.storeLandmark_uz+=t.street),t.house&&(this.storeLandmark_ru+=" "+t.house,this.storeLandmark_uz+=" "+t.house)):(t.other&&(this.storeLandmark_ru+=" "+t.other,this.storeLandmark_uz+=" "+t.other),t.area&&(this.storeLandmark_ru+=" "+t.area,this.storeLandmark_uz+=" "+t.area))})},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},requestGetcategories(){let a=this.url+"api/v1/store/category?page=1",r=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r})};fetch(a,c).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.categories=e.data})},requestGetStoreOwners(){let a=this.url+"api/v1/store/storeOwner",r=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r})};fetch(a,c).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.storeOwners=e.data})},async getStoreAbout(){let a=this.url+"api/v1/store/digitalstore?store_id="+this.$route.params.id,r=localStorage.getItem("token");const c={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r})};fetch(a,c).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{e&&(this.name=e.name,this.categoryID=e.category_id,this.banner_ru_prev=this.url+"files/digitalStores/"+e.logo)})}},created(){this.requestGetcategories(),this.getStoreAbout()}},p=a=>(T("data-v-e132c822"),a=a(),U(),a),x={class:"mt-3"},N={class:"row"},F={class:"col-md-12 grid-margin stretch-card"},O={class:"card"},R={class:"card-body"},V=p(()=>o("h4",{class:"card-title"},"Update Store",-1)),M={class:"error"},$={key:1,class:"error"},H={key:2,class:"success"},P={class:"form-group row"},J={class:"col-md-6"},K=p(()=>o("label",{for:"banner"},"Category",-1)),Q=p(()=>o("option",{disabled:"",value:"0"},"Please select one",-1)),W=["value"],X={class:"col-md-6"},Y=p(()=>o("label",{for:"exampleInputNameRu"},"Name",-1)),Z={class:"col-md-12"},ee=p(()=>o("label",{class:"col-sm-4",for:"banner"},"Logo",-1)),te=["src"],re=["disabled"];function se(a,r,c,e,s,t){const u=B("GoBackButton");return i(),l(m,null,[D(u),o("div",x,[o("div",N,[o("div",F,[o("div",O,[o("div",R,[V,s.resError?(i(!0),l(m,{key:0},g(s.resError,(n,h)=>(i(),l("p",M,d(h)+" : "+d(n[0]),1))),256)):_("",!0),s.resStringError?(i(),l("p",$,d(s.resStringError),1)):_("",!0),s.resSuccess?(i(),l("p",H,d(s.resSuccess),1)):_("",!0),o("form",{class:"forms-sample",onSubmit:r[3]||(r[3]=E(n=>t.submitForm(),["prevent"]))},[o("div",P,[o("div",J,[K,v(o("select",{"onUpdate:modelValue":r[0]||(r[0]=n=>s.categoryID=n),class:y(["form-control",{"border border-danger":e.v$.categoryID.$errors.length>0}])},[Q,(i(!0),l(m,null,g(s.categories,n=>(i(),l("option",{key:n.id,value:n.id},d(JSON.parse(n.name).ru),9,W))),128))],2),[[A,s.categoryID]]),(i(!0),l(m,null,g(e.v$.categoryID.$errors,(n,h)=>(i(),l("small",{class:"error",key:h},d(n.$message),1))),128))]),o("div",X,[Y,v(o("input",{type:"text",class:y(["form-control",{"border border-danger":e.v$.name.$errors.length>0}]),placeholder:"Store Name",id:"exampleInputNameRu","onUpdate:modelValue":r[1]||(r[1]=n=>s.name=n)},null,2),[[q,s.name]]),(i(!0),l(m,null,g(e.v$.name.$errors,(n,h)=>(i(),l("small",{class:"error",key:h},d(n.$message),1))),128))]),o("div",Z,[ee,o("img",{src:s.banner_ru_prev,width:"400",class:"image_prev"},null,8,te),o("input",{type:"file",id:"banner",onChange:r[2]||(r[2]=n=>t.uploadFilebannerRu(n)),accept:"image/*",class:"form-control"},null,32)])]),s.added?_("",!0):(i(),l("button",{key:0,type:"submit",disabled:t.isDisabled,class:"btn btn-primary mr-2"},"Update",8,re))],32)])])])])])],64)}const ue=j(G,[["render",se],["__scopeId","data-v-e132c822"]]);export{ue as default};
