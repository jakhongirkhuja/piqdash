import{G as y}from"./GoBackButton.8ec57f12.js";import{c as S}from"./vue-datepicker.es.17b3f44e.js";import{h as k}from"./maska.esm.cd315c5a.js";import{u as w,r as v,m as I}from"./index.esm.b21b73c4.js";import{_ as D,a4 as j,a5 as B,r as A,o as n,c as i,f as C,a as o,F as p,e as h,d as _,t as c,l as E,w as b,p as q,n as f,v as x,a2 as G,a3 as O}from"./index.34e73fda.js";import{s as z}from"./globalFunction.5ce06618.js";const F={setup(){return{v$:w()}},directives:{maska:k},components:{GoBackButton:y,Datepicker:S,yandexMap:j,ymapMarker:B},data(){return{url:"https://api.pharmiq.uz/",name:"",added:!1,resError:!1,resSuccess:!1,resStringError:"",userInfo:null,categoryID:null,categories:[],banner_ru_prev:null,banner_ru:null}},computed:{isDisabled:function(){if(this.v$.$touch(),this.v$.$error)return!0}},validations(){return{banner_ru:{required:v},name:{required:v,minLengthValue:I(3)},categoryID:{required:v}}},methods:{async requestApi(){this.added=!0;const a={name:this.name,category_id:this.categoryID},r=z(),l=Object.assign(a,r);var e=new FormData;e.append("logo",this.banner_ru);for(const t in l)e.append(t,l[t]);try{let t=localStorage.getItem("token");const m=await fetch(this.url+"api/v1/store/digitalstore/add",{method:"POST",body:e,headers:{"Accept-Language":"en-US,en;q=0.8",accept:"application/json",Authorization:"Bearer "+t}}),d=await m.json();window.scrollTo({top:0,behavior:"smooth"}),m.status==401?(this.resStringError=d.message,this.added=!1):d.error?(typeof d.message=="object"?this.resError=d.message:this.resStringError=d.message,this.added=!1):this.resSuccess="Store Successfully Added"}catch(t){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t)}},uploadFilebannerRu(a){var r=a.target.files||a.dataTransfer.files;if(!r.length){this.banner_ru=[],this.banner_ru_prev="";return}this.banner_ru=r[0],this.banner_ru_prev=URL.createObjectURL(r[0])},submitForm(){this.v$.$touch(),!this.v$.$error&&this.requestApi()},requestGetcategories(){let a=this.url+"api/v1/store/category?page=1",r=localStorage.getItem("token");const l={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r})};fetch(a,l).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.categories=e.data})},requestGetStoreOwners(){let a=this.url+"api/v1/store/storeOwner",r=localStorage.getItem("token");const l={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r})};fetch(a,l).then(e=>(e.status==401&&(localcategoryage.removeItem("token"),localcategoryage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),e.json())).then(e=>{this.storeOwners=e.data})}},created(){this.requestGetcategories(),this.requestGetStoreOwners(),ymaps.ready(a=>{var r=new ymaps.Map("map",{center:[41.311081,69.240562],zoom:11},{searchControlProvider:"yandex#search"});console.log(this.lat),r.events.add("click",l=>{if(r.balloon.isOpen())r.balloon.close();else{var e=l.get("coords");r.balloon.open(e,{contentBody:"<p>Coordinates: "+[e[0].toPrecision(6),e[1].toPrecision(6)].join(", ")+"</p>",contentFooter:"<sup>Click again</sup>"}),this.getAddressByCoor(e[0],e[1])}})})}},g=a=>(G("data-v-ae3ded4a"),a=a(),O(),a),N={class:"mt-3"},T={class:"row"},L={class:"col-md-12 grid-margin stretch-card"},M={class:"card"},R={class:"card-body"},U=g(()=>o("h4",{class:"card-title"},"Add Store",-1)),V={class:"error"},$={key:1,class:"error"},P={key:2,class:"success"},H={class:"form-group row"},J={class:"col-md-6"},K=g(()=>o("label",{for:"banner"},"Category",-1)),Q=g(()=>o("option",{disabled:"",value:"0"},"Please select one",-1)),W=["value"],X={class:"col-md-6"},Y=g(()=>o("label",{for:"exampleInputNameRu"},"Name",-1)),Z={class:"col-md-12"},ee=g(()=>o("label",{class:"col-sm-4",for:"banner"},"Logo",-1)),re=["src"],te=["disabled"];function se(a,r,l,e,t,m){const d=A("GoBackButton");return n(),i(p,null,[C(d),o("div",N,[o("div",T,[o("div",L,[o("div",M,[o("div",R,[U,t.resError?(n(!0),i(p,{key:0},h(t.resError,(s,u)=>(n(),i("p",V,c(u)+" : "+c(s[0]),1))),256)):_("",!0),t.resStringError?(n(),i("p",$,c(t.resStringError),1)):_("",!0),t.resSuccess?(n(),i("p",P,c(t.resSuccess),1)):_("",!0),o("form",{class:"forms-sample",onSubmit:r[3]||(r[3]=E(s=>m.submitForm(),["prevent"]))},[o("div",H,[o("div",J,[K,b(o("select",{"onUpdate:modelValue":r[0]||(r[0]=s=>t.categoryID=s),class:f(["form-control",{"border border-danger":e.v$.categoryID.$errors.length>0}])},[Q,(n(!0),i(p,null,h(t.categories,s=>(n(),i("option",{key:s.id,value:s.id},c(JSON.parse(s.name).ru),9,W))),128))],2),[[q,t.categoryID]]),(n(!0),i(p,null,h(e.v$.categoryID.$errors,(s,u)=>(n(),i("small",{class:"error",key:u},c(s.$message),1))),128))]),o("div",X,[Y,b(o("input",{type:"text",class:f(["form-control",{"border border-danger":e.v$.name.$errors.length>0}]),placeholder:"Store Name",id:"exampleInputNameRu","onUpdate:modelValue":r[1]||(r[1]=s=>t.name=s)},null,2),[[x,t.name]]),(n(!0),i(p,null,h(e.v$.name.$errors,(s,u)=>(n(),i("small",{class:"error",key:u},c(s.$message),1))),128))]),o("div",Z,[ee,o("img",{src:t.banner_ru_prev,width:"400",class:"image_prev"},null,8,re),o("input",{type:"file",id:"banner",onChange:r[2]||(r[2]=s=>m.uploadFilebannerRu(s)),accept:"image/*",class:f([{"border border-danger":e.v$.banner_ru.$errors.length>0},"form-control"])},null,34),(n(!0),i(p,null,h(e.v$.banner_ru.$errors,(s,u)=>(n(),i("small",{class:"error",key:u},c(s.$message),1))),128))])]),t.added?_("",!0):(n(),i("button",{key:0,type:"submit",disabled:m.isDisabled,class:"btn btn-primary mr-2"},"Create",8,te))],32)])])])])])],64)}const de=D(F,[["render",se],["__scopeId","data-v-ae3ded4a"]]);export{de as default};
