import{C as v,P as I}from"./Pagination.b8ff8fbc.js";import{L as S}from"./LanguageSwitcher.c9c9f8e9.js";import{s as w}from"./globalFunction.5ce06618.js";import{_ as k,r as _,o as l,c as a,a as e,b as g,d,F as m,e as f,t as i,a2 as C,a3 as D,h as P}from"./index.34e73fda.js";const A={data(){return{imageUrl:"https://api.pharmiq.uz/files/lottery/",disabled:!1,modelName:"",modelUserId:"",currentPage:1,last_page:1,total:1,per_page:1,lottery:[],response:null,resError:!1,resSuccess:!1,resStringError:"",submitButton:!0,lotteryearch:"",timerId:null,url:"https://api.pharmiq.uz/",loading:!0,userInfo:null}},components:{CrudButton:v,Pagination:I,LanguageSwitcher:S},computed:{},methods:{checkStatus(t,n){let c=new Date(t);return n&&new Date>n?"Arxived":c>new Date?(console.log(c,new Date),"upgoing"):(c<=new Date,"ongoing")},getlastOrder(t){return t.length==0?0:(t.sort(function(n,c){return c.order-n.order}),t[0].order)},showImageUrl(t){return this.imageUrl+t},searchlottery(){clearTimeout(this.timerId),this.lotteryearch!=""?(this.loading=!0,this.timerId=setTimeout(()=>{this.requestApi(1,this.lotteryearch)},2e3)):(this.loading=!0,this.timerId=setTimeout(()=>this.requestApi(this.currentPage),2e3))},showlesson(t){this.$router.push({name:"lottery.show",params:{id:t}})},openmodel(t,n){this.modelUserId=t,this.modelName=n,this.submitButton=!0,this.resError=!1,this.resSuccess=!1,this.resStringError="",$("#exampleModal").modal("show")},showUrl(){console.log("https://api.pharmiq.uz/")},editlesson(t){this.$router.push({name:"lottery.edit",params:{id:t}})},onPageChange(t){console.log(t),this.currentPage=t,this.loading=!0,this.requestApi(t),localStorage.setItem("currentPage",t)},refreshList(){this.loading=!0,this.requestApi(1)},async requestApiDelete(){this.disabled=!0;const t={lottery_id:this.modelUserId},n=w(),c=Object.assign(t,n);try{let h=localStorage.getItem("token");const o=await(await fetch(this.url+"api/v1/lottery/delete",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json",accept:"application/json",Authorization:"Bearer "+h}})).json();o.error?typeof o.message=="object"?this.resError=o.message:this.resStringError=o.message:(this.resSuccess="Successfully Deleted",this.refreshList(),this.submitButton=!1)}catch(h){console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",h)}},requestApi(t,n=null){let c=this.url+"api/v1/lottery?page="+t,h=localStorage.getItem("token");const s={method:"GET",headers:new Headers({accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+h})};fetch(c,s).then(o=>(o.status==401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="https://go.pharmiq.uz/"),o.json())).then(o=>{this.response=o,this.last_page=o.last_page,this.total=o.total,this.per_page=o.per_page,this.lotteries=o.data,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.loading=!1},1e3)})}},mounted(){this.$i18n.locale="ru",console.log(this.$i18n.availableLocales)},created(){this.userInfo=JSON.parse(localStorage.getItem("user"));const t=localStorage.getItem("currentPage");t&&(this.currentPage=parseInt(t)),this.requestApi(1)}},u=t=>(C("data-v-0e0914ea"),t=t(),D(),t),E={class:"row"},L={class:"col-md-3"},q=u(()=>e("div",{class:"col-md-6"},null,-1)),x={class:"mt-3"},B={class:"row"},N={class:"col-12"},O={class:"table-responsive"},T={class:"table"},U=u(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"Description"),e("th",{scope:"col"},"Start Date - End Date"),e("th",{scope:"col"},"Limit"),e("th",{scope:"col"},"Users"),e("th",{scope:"col"},"Course"),e("th",{scope:"col"},"Actions")])],-1)),j={class:"actions"},z=["onClick"],M=u(()=>e("i",{class:"ti ti-eye","data-toggle":"tooltip",title:"Show"},null,-1)),J=[M],F=["onClick"],V=u(()=>e("i",{class:"ti ti-pencil-alt","data-toggle":"tooltip",title:"Edit"},null,-1)),G=[V],H=["onClick"],R=u(()=>e("i",{class:"ti ti-trash","data-toggle":"tooltip",title:"Delete"},null,-1)),K=[R],Q={class:"modal fade",id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},W={class:"modal-dialog",role:"document"},X={class:"modal-content"},Y=u(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Delete lottery"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"\xD7")])],-1)),Z={class:"modal-body text-center"},ee={class:"error"},te={key:1,class:"error"},se={key:2,class:"success"},oe=u(()=>e("h4",null,"Are you sure you want to delete this lottery?",-1)),re={class:"modal-footer"},le=u(()=>e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Close",-1)),ie=["disabled"],ne={key:0,class:"loading"},ae=u(()=>e("img",{src:P},null,-1)),ce=[ae];function de(t,n,c,h,s,o){const y=_("CrudButton"),b=_("Pagination");return l(),a(m,null,[e("div",E,[e("div",L,[s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(l(),g(y,{key:0,urlName:"lottery.add",btnName:"Add Lottery"})):d("",!0)]),q]),e("div",x,[e("div",B,[e("div",N,[e("div",O,[e("table",T,[U,e("tbody",null,[(l(!0),a(m,null,f(t.lotteries,r=>(l(),a("tr",{key:r.id},[e("td",null,i(r.name),1),e("td",null,i(r.description),1),e("td",null,i(r.startDate.slice(0,10))+" - "+i(r.endDate.slice(0,10)),1),e("td",null,i(r.limit),1),e("td",null,i(o.getlastOrder(r.lottery_logs)),1),e("td",null,i(JSON.parse(r.course.getinfo.courseTitleName).ru),1),e("td",j,[e("div",{onClick:p=>o.showlesson(r.id),class:"show text-primary mr-2 cursor-pointer"},J,8,z),s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(l(),a("div",{key:0,onClick:p=>o.editlesson(r.id),class:"edit mr-2 cursor-pointer"},G,8,F)):d("",!0),s.userInfo&&(s.userInfo.role=="Creator"||s.userInfo.role=="Owner")?(l(),a("div",{key:1,"data-toggle":"modal","data-target":"#exampleModal cursor-pointer",onClick:p=>o.openmodel(r.id,r.name),class:"delete text-danger"},K,8,H)):d("",!0)])]))),128))])])]),s.last_page!=1?(l(),g(b,{key:0,"total-pages":this.last_page,total:this.total,"per-page":this.per_page,"current-page":s.currentPage,onPagechanged:o.onPageChange},null,8,["total-pages","total","per-page","current-page","onPagechanged"])):d("",!0)])])]),e("div",Q,[e("div",W,[e("div",X,[Y,e("div",Z,[s.resError?(l(!0),a(m,{key:0},f(s.resError,(r,p)=>(l(),a("p",ee,i(p)+" : "+i(r[0]),1))),256)):d("",!0),s.resStringError?(l(),a("p",te,i(s.resStringError),1)):d("",!0),s.resSuccess?(l(),a("p",se,i(s.resSuccess),1)):d("",!0),oe,e("h4",null,i(s.modelName),1),e("p",null,"lottery Id: "+i(s.modelUserId),1)]),e("div",re,[le,s.submitButton?(l(),a("button",{key:0,disabled:s.disabled,type:"button",onClick:n[0]||(n[0]=(...r)=>o.requestApiDelete&&o.requestApiDelete(...r)),class:"btn btn-primary"},"Delete lottery",8,ie)):d("",!0)])])])]),s.loading?(l(),a("div",ne,ce)):d("",!0)],64)}const _e=k(A,[["render",de],["__scopeId","data-v-0e0914ea"]]);export{_e as default};
